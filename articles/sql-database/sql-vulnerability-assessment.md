---
title: Avaliação de Vulnerabilidades do SQL
description: Saiba como configurar a Avaliação de Vulnerabilidade SQL na Base de Dados Azure SQL e interprete os relatórios de avaliação.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 04/19/2020
tags: azure-synapse
ms.openlocfilehash: 80629898b56f81fc738cb30df63766ea39adea6d
ms.sourcegitcommit: acb82fc770128234f2e9222939826e3ade3a2a28
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 04/21/2020
ms.locfileid: "81684257"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>SQL Vulnerability Assessment ajuda-o a identificar vulnerabilidades de base de dados

A Avaliação de Vulnerabilidade SQL é um serviço fácil de configurar que pode descobrir, rastrear e ajudá-lo a remediar potenciais vulnerabilidades de base de dados. Utilize-a para melhorar proativamente a segurança da base de dados.

A Avaliação de Vulnerabilidade sintetiza a oferta avançada de Segurança de [Dados,](sql-database-advanced-data-security.md) que é um pacote unificado para capacidades avançadas de segurança SQL. A Avaliação de Vulnerabilidade pode ser acedida e gerida através do portal central de Segurança Avançada de Dados SQL.

> [!NOTE]
> A Avaliação de Vulnerabilidadeé suportada para a Base de Dados Azure SQL, a base de dados Azure SQL gerida e a Azure Synapse Analytics. Para a simplicidade, a Base de Dados SQL é utilizada neste artigo quando se refere a qualquer um destes serviços de base de dados geridos.

## <a name="vulnerability-assessment"></a>Avaliação de vulnerabilidades

SQL Vulnerability Assessment é um serviço que fornece visibilidade ao seu estado de segurança. A Avaliação de Vulnerabilidades inclui medidas acionáveis para resolver problemas de segurança e melhorar a segurança da sua base de dados. Pode ajudá-lo: 

- Cumprir os requisitos de conformidade que requerem relatórios de digitalização de base de dados.
- Cumprir os padrões de privacidade dos dados.
- Monitorize um ambiente dinâmico de base de dados onde as alterações são difíceis de rastrear.

A Avaliação de Vulnerabilidades é um serviço de digitalização incorporado na Base de Dados Azure SQL. O serviço emprega uma base de conhecimentos de regras que sinalizam vulnerabilidades de segurança. Destaca desvios das melhores práticas, tais como configurações erradas, permissões excessivas e dados sensíveis desprotegidos.

As regras baseiam-se nas melhores práticas da Microsoft e focam-se nos problemas de segurança que apresentam os maiores riscos para a sua base de dados e os seus dados valiosos. Eles cobrem problemas de nível de base de dados e problemas de segurança ao nível do servidor, como definições de firewall do servidor e permissões ao nível do servidor. Estas regras representam também muitos dos requisitos de várias entidades reguladoras para cumprir as suas normas de conformidade.

Os resultados da varredura incluem passos atos para resolver cada problema e fornecer scripts de reparação personalizados quando aplicável. Pode personalizar um relatório de avaliação para o seu ambiente, estabelecendo uma linha de base aceitável para:
* Configurações de permissão.
* Configurações de recurso.
* Definições da base de dados.

## <a name="implement-vulnerability-assessment"></a>Implementar avaliação de vulnerabilidade

Os seguintes passos implementam a avaliação de vulnerabilidade na base de dados SQL.

### <a name="1-run-a-scan"></a>1. Fazer uma varredura

No painel de dados Azure SQL, sob a rubrica **Segurança,** **selecione Advanced Data Security**. Em seguida, clique em **Selecionar armazenamento** no painel de **avaliação** de vulnerabilidade para abrir o painel de definições de avaliação de vulnerabilidade para todo o servidor SQL.

Configure uma conta de armazenamento onde os resultados da sua digitalização para todas as bases de dados do servidor serão armazenados. Para obter informações sobre contas de armazenamento, consulte as contas de [armazenamento do Azure.](../storage/common/storage-create-storage-account.md) Depois de configurado o armazenamento, selecione **Scan** para digitalizar a sua base de dados para obter vulnerabilidades.

![Digitalizar uma base de dados](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > A tomografia é leve e segura. Leva alguns segundos para correr e é inteiramente apenas lido. Não faz alterações na sua base de dados.

### <a name="2-view-the-report"></a>2. Ver o relatório

Quando a sua verificação estiver concluída, o seu relatório de digitalização é automaticamente apresentado no portal Azure. O relatório apresenta uma visão geral do seu estado de segurança. Ele enumera quantas questões foram encontradas e as respetivas severidades. Os resultados incluem avisos sobre desvios das melhores práticas e uma imagem instantânea das suas definições relacionadas com a segurança, tais como diretores e funções de base de dados e respetivas permissões associadas. O relatório de digitalização também fornece um mapa de dados sensíveis descobertos na sua base de dados. Inclui recomendações para classificar esses dados utilizando a [descoberta e a classificação](sql-database-data-discovery-and-classification.md)de dados.

![Veja o relatório](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Analisar os resultados e resolver problemas

Reveja os seus resultados e determine as conclusões do relatório que são verdadeiras questões de segurança no seu ambiente. Aperte minuciosamente cada resultado falhado para entender o impacto da descoberta e por que cada verificação de segurança falhou. Utilize as informações de reparação atoveis fornecidas pelo relatório para resolver a questão.

![Analisar o relatório](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Desloque a sua linha de base

Ao rever os resultados da sua avaliação, pode marcar resultados específicos como sendo uma linha de *base* aceitável no seu ambiente. A linha de base é essencialmente uma personalização de como os resultados são reportados. Os resultados que correspondem à linha de base são considerados como passando em exames subsequentes. Depois de estabelecer o seu estado de segurança de base, a Avaliação de Vulnerabilidade apenas reporta desvios a partir da linha de base. Desta forma, pode concentrar a sua atenção nas questões relevantes.

![Desloque a sua linha de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Executar uma nova digitalização para ver o seu relatório de rastreio personalizado

Depois de terminar de configurar as suas Linhas de Base de **Regra,** faça uma nova digitalização para ver o relatório personalizado. A Avaliação de Vulnerabilidade agora reporta apenas os problemas de segurança que se desviam do seu estado de base aprovado.

![Veja o seu relatório personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

A Avaliação de Vulnerabilidades pode agora ser usada para monitorizar que a sua base de dados mantém um alto nível de segurança em todos os momentos, e que as suas políticas organizacionais são cumpridas. Se forem necessários relatórios de conformidade, os relatórios de Avaliação de Vulnerabilidade podem ser úteis para facilitar o processo de conformidade.

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configurar varreduras periódicas recorrentes

Vá às definições de Avaliação de Vulnerabilidade para ligar **as varreduras periódicas recorrentes**. Esta definição configura a Avaliação de Vulnerabilidade para executar automaticamente uma verificação na sua base de dados uma vez por semana. Um resumo do resultado da digitalização é enviado para os endereços de e-mail que fornece.

![Veja o seu relatório personalizado](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Exportar um relatório de avaliação

Selecione Resultados de **Digitalização de Exportação** para criar um relatório Excel descarregado do seu resultado de digitalização. Este relatório contém um separador resumido que apresenta um resumo da avaliação. O relatório inclui todos os controlos falhados. Também inclui um separador **Resultados** que contém o conjunto completo de resultados da digitalização. Os resultados incluem todos os controlos que foram executados e os detalhes do resultado para cada um.

### <a name="8-view-scan-history"></a>8. Ver história de digitalização

Selecione Histórico de **Digitalização** no painel de Avaliação de Vulnerabilidades para ver um histórico de todos os exames anteriormente executados nesta base de dados. Selecione uma determinada digitalização na lista para ver os resultados detalhados dessa digitalização.

A Avaliação de Vulnerabilidades pode agora ser usada para monitorizar que a sua base de dados mantém um alto nível de segurança em todos os momentos, e que as suas políticas organizacionais são cumpridas. Se forem necessários relatórios de conformidade, os relatórios de Avaliação de Vulnerabilidade podem ser úteis para facilitar o processo de conformidade.

## <a name="manage-vulnerability-assessments-by-using-azure-powershell"></a>Gerir avaliações de vulnerabilidade utilizando o Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> O módulo PowerShell Azure Resource Manager ainda é suportado pela Base de Dados Azure SQL, mas todo o desenvolvimento futuro é para o módulo Az.Sql. Para estes cmdlets, consulte [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Os argumentos para os comandos no módulo Az e nos módulos AzureRm são substancialmente idênticos.

Pode utilizar cmdlets Azure PowerShell para gerir programáticamente as suas avaliações de vulnerabilidade. Os cmdlets suportados são:

| Nome cmdlet como um link | Descrição |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Elimina a linha de base da regra de avaliação de vulnerabilidades.<br/>Primeiro, deite a linha de base antes de utilizar este cmdlet para limpá-la. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Limpa as definições de Avaliação de Vulnerabilidade de uma base de dados. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Converte os resultados da avaliação de vulnerabilidade num ficheiro Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Obtém a regra de avaliação de vulnerabilidade seletiva para uma determinada regra. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Obtém todos os registos de avaliação de vulnerabilidade associados a uma determinada base de dados. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Devolve as definições de Avaliação de Vulnerabilidade de uma base de dados. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Define a linha de base da regra de Avaliação de Vulnerabilidades. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Despoleta o início de uma avaliação de vulnerabilidade. |
| [Atualização-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Atualiza as definições de Avaliação de Vulnerabilidade de uma base de dados. |
| &nbsp; | &nbsp; |

Para um exemplo de script, consulte o suporte PowerShell de avaliação de vulnerabilidade da [Vulnerabilidade Azure SQL](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessment-baseline-rules-by-using-resource-manager-templates"></a>Gerir as regras de base da avaliação de vulnerabilidade utilizando modelos de Gestor de Recursos

Para configurar as linhas de base de avaliação de `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` vulnerabilidade utilizando modelos de Gestor de Recursos Azure, utilize o tipo.

Certifique-se de `vulnerabilityAssessments` que ativou o computador que está a executar o SQL Server antes de adicionar as linhas de base.

Aqui está um exemplo para definir a Regra de Base VA2065 para masterdb e VA1143 para userdb como recursos em um modelo de Gestor de Recursos:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Para a base de dados principal e base de dados do utilizador, os nomes dos recursos são definidos de forma diferente:

* Base de dados principal - "nome": "[concat('server_name''/', parâmetros('database_name') , '/default/VA2065/<b>master']",</b>
* Base de dados do utilizador - "nome": "[concat('server_name'''/', parâmetros('database_name') , '/default/VA2065/<b>predefinido</b>')'",",
 
 
 Para lidar com os tipos booleanos como verdadeiros/falsos, detete o resultado da linha de base com uma entrada binária como "1"/"0".
 
```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Passos seguintes  

- Saiba mais sobre [a Segurança avançada de dados.](sql-database-advanced-data-security.md)
- Saiba mais sobre [a descoberta e classificação](sql-database-data-discovery-and-classification.md)de dados.
