---
title: Avaliação de Vulnerabilidades do SQL
description: Saiba como configurar e avaliar a vulnerabilidade do SQL na Base de Dados SQL e interprete os relatórios de avaliação.
services: sql-database
ms.service: sql-database
ms.subservice: security
ms.custom: ''
ms.devlang: ''
ms.topic: conceptual
author: mibar
ms.author: mibar
ms.reviewer: vanto, carlrab
ms.date: 02/05/2020
tags: azure-synapse
ms.openlocfilehash: 87f3c4b0489c48f758ce9e660bdfd599c086b677
ms.sourcegitcommit: 225a0b8a186687154c238305607192b75f1a8163
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 02/29/2020
ms.locfileid: "78191984"
---
# <a name="sql-vulnerability-assessment-service-helps-you-identify-database-vulnerabilities"></a>O serviço de Avaliação de VulnerabilidadeS SQL ajuda-o a identificar vulnerabilidades na base de dados

A Avaliação de Vulnerabilidade SQL é um serviço fácil de configurar que pode descobrir, rastrear e ajudá-lo a remediar potenciais vulnerabilidades de base de dados. Utilize-a para melhorar proativamente a segurança da base de dados.

A Avaliação de Vulnerabilidade sintetiza parte da oferta avançada de segurança de [dados](sql-database-advanced-data-security.md) (ADS), que é um pacote unificado para capacidades avançadas de segurança SQL. A Avaliação de Vulnerabilidade pode ser acedida e gerida através do portal Central SQL ADS.

> [!NOTE]
> A Avaliação de Vulnerabilidade é suportada para a Base de Dados Azure SQL, P.M. Azure SQL e Azure Synapse Analytics. Para a simplicidade, a Base de Dados SQL é utilizada neste artigo quando se refere a qualquer um destes serviços de base de dados geridos.

## <a name="the-vulnerability-assessment-service"></a>O serviço de Avaliação de Vulnerabilidades

SQL Vulnerability Assessment (VA) é um serviço que fornece visibilidade ao seu estado de segurança, e inclui medidas acionáveis para resolver problemas de segurança e melhorar a segurança da sua base de dados. Pode ajudá-lo:  

- Cumprir os requisitos de conformidade que requerem relatórios de digitalização de base de dados.  
- Cumprir os padrões de privacidade dos dados.  
- Monitorize um ambiente dinâmico de base de dados onde as alterações são difíceis de rastrear.  

A Avaliação de Vulnerabilidades é um serviço de digitalização incorporado no serviço de base de dados Azure SQL. O serviço emprega uma base de conhecimentos de regras que sinalizam vulnerabilidades de segurança e destacam desvios das melhores práticas, tais como configurações erradas, permissões excessivas e dados sensíveis desprotegidos. As regras baseiam-se nas melhores práticas da Microsoft e focam-se nos problemas de segurança que apresentam os maiores riscos para a sua base de dados e os seus dados valiosos. Eles cobrem ambos os problemas de nível de base de dados, bem como problemas de segurança ao nível do servidor, como definições de firewall do servidor e permissões ao nível do servidor. Estas regras representam também muitos dos requisitos de várias entidades reguladoras para cumprir as suas normas de conformidade.  

Os resultados da varredura incluem passos atos para resolver cada problema e fornecer scripts de reparação personalizados quando aplicável. Um relatório de avaliação pode ser personalizado para o seu ambiente, definindo uma linha de base aceitável para configurações de permissões, configurações de funcionalidades e configurações de bases de dados.

## <a name="implementing-vulnerability-assessment"></a>Implementação da Avaliação de Vulnerabilidades

Os seguintes passos implementam VA na Base de Dados SQL.  

### <a name="1-run-a-scan"></a>1. Fazer uma varredura  

Inicie com VA navegando para **Advanced Data Security** sob a direção de Segurança no seu painel de base de dados Azure SQL. Clique para ativar a segurança avançada de dados e, em seguida, clique em **Select Storage** ou no cartão de Avaliação de **Vulnerabilidade,** que abre automaticamente o cartão de definições de Avaliação de Vulnerabilidade para todo o servidor SQL.

Comece por configurar uma conta de armazenamento onde os resultados da sua digitalização para todas as bases de dados do servidor serão armazenados. Para obter informações sobre contas de armazenamento, consulte as contas de [armazenamento do Azure.](../storage/common/storage-create-storage-account.md) Uma vez configurado o armazenamento, clique em **Digitalizar** a sua base de dados para obter vulnerabilidades.
  
![Digitalizar uma base de dados](./media/sql-vulnerability-assessment/pp_va_initialize.png)  

  > [!NOTE]
  > A tomografia é leve e segura. Leva alguns segundos para correr, e é inteiramente apenas lido. Não faz alterações na sua base de dados.  

### <a name="2-view-the-report"></a>2. Ver o relatório

Quando a sua verificação estiver concluída, o seu relatório de digitalização é automaticamente apresentado no portal Azure. O relatório apresenta uma visão geral do seu estado de segurança: quantas questões foram encontradas e respetivas severidades. Os resultados incluem avisos sobre desvios das melhores práticas e uma imagem instantânea das suas definições relacionadas com a segurança, tais como diretores e funções de base de dados e respetivas permissões associadas. O relatório de digitalização também fornece um mapa de dados sensíveis descobertos na sua base de dados, e inclui recomendações para classificar esses dados usando [a descoberta e classificação](sql-database-data-discovery-and-classification.md)de dados .

![Veja o relatório](./media/sql-vulnerability-assessment/pp_main_getstarted.png)  

### <a name="3-analyze-the-results-and-resolve-issues"></a>3. Analisar os resultados e resolver problemas

Reveja os seus resultados e determine as conclusões do relatório que são verdadeiras questões de segurança no seu ambiente. Aperte minuciosamente cada resultado falhado para entender o impacto da descoberta e por que cada verificação de segurança falhou. Utilize as informações de reparação atoveis fornecidas pelo relatório para resolver a questão.  

![Analisar o relatório](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

### <a name="4-set-your-baseline"></a>4. Desloque a sua linha de base

Ao rever os resultados da sua avaliação, pode marcar resultados específicos como sendo uma *Linha de Base* aceitável no seu ambiente. A linha de base é essencialmente uma personalização de como os resultados são reportados. Os resultados que correspondem à linha de base são considerados como passando em exames subsequentes. Uma vez estabelecido o seu estado de segurança de base, o VA reporta apenas sobre desvios a partir da linha de base e pode concentrar a sua atenção nas questões relevantes.  

![Desloque a sua linha de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)  

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5. Executar uma nova digitalização para ver o seu relatório de rastreio personalizado

Depois de completar a configuração das suas Linhas de Base de **Regra,** faça uma nova digitalização para ver o relatório personalizado. A VA informa agora apenas os problemas de segurança que se desviam do seu estado de base aprovado.

![Veja o seu relatório personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)  

A Avaliação de Vulnerabilidades pode agora ser usada para monitorizar que a sua base de dados mantém um alto nível de segurança em todos os momentos, e que as suas políticas organizacionais são cumpridas. Se forem necessários relatórios de conformidade, os relatórios de VA podem ser úteis para facilitar o processo de conformidade.  

### <a name="6-set-up-periodic-recurring-scans"></a>6. Configurar varreduras periódicas recorrentes

Navegue para as definições de Avaliação de Vulnerabilidade para ligar **as varreduras periódicas recorrentes**. Esta avaliação de vulnerabilidade configura para executar automaticamente uma verificação na sua base de dados uma vez por semana. Um resumo do resultado da digitalização será enviado para o endereço de e-mail(es) que fornecer.

![Veja o seu relatório personalizado](./media/sql-vulnerability-assessment/pp_recurring_scans.png)

### <a name="7-export-an-assessment-report"></a>7. Exportar um relatório de avaliação

Clique em **Exportar Resultados** de digitalização para criar um relatório excel transferível do seu resultado de digitalização. Este relatório contém um separador resumido que apresenta um resumo da avaliação, incluindo todos os controlos falhados. Também inclui um separador **Resultados** contendo o conjunto completo de resultados da varredura, incluindo todos os controlos que foram executados e os detalhes do resultado para cada um.

### <a name="8-view-scan-history"></a>8. Ver história de digitalização

Clique em **History de Digitalização** no painel VA para ver um histórico de todos os exames anteriormente executados nesta base de dados. Selecione uma determinada digitalização na lista para ver os resultados detalhados dessa digitalização.

A Avaliação de Vulnerabilidades pode agora ser usada para monitorizar que a sua base de dados mantém um alto nível de segurança em todos os momentos, e que as suas políticas organizacionais são cumpridas. Se forem necessários relatórios de conformidade, os relatórios de VA podem ser úteis para facilitar o processo de conformidade.

## <a name="manage-vulnerability-assessments-using-azure-powershell"></a>Gerir avaliações de vulnerabilidade utilizando o Azure PowerShell

[!INCLUDE [updated-for-az](../../includes/updated-for-az.md)]
> [!IMPORTANT]
> O módulo PowerShell Azure Resource Manager ainda é suportado pela Base de Dados Azure SQL, mas todo o desenvolvimento futuro é para o módulo Az.Sql. Para estes cmdlets, consulte [AzureRM.Sql](https://docs.microsoft.com/powershell/module/AzureRM.Sql/). Os argumentos para os comandos no módulo Az e nos módulos AzureRm são substancialmente idênticos.

Pode utilizar cmdlets Azure PowerShell para gerir programáticamente as suas avaliações de vulnerabilidade. Os cmdlets suportados são:

- [Atualização-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting)

  Atualiza as definições de avaliação de vulnerabilidade de uma base de dados
- [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting)

  Devolve as definições de avaliação de vulnerabilidade de uma base de dados
- [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting)

  Limpa as definições de avaliação de vulnerabilidade de uma base de dados
- [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Define a linha de base da regra de avaliação da vulnerabilidade.
- [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Obtém a regra de avaliação de vulnerabilidade seletiva para uma determinada regra.
- [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](https://docs.microsoft.com/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline)

  Limpa a linha de base da regra de avaliação da vulnerabilidade. Primeiro, desloque a linha de base antes de utilizar este cmdlet para limpá-la.
- [Start-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan)

  Desencadeia o início de uma avaliação de vulnerabilidade
- [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](https://docs.microsoft.com/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord)

   Obtém todos os registos de avaliação de vulnerabilidade scan(s) associados a uma determinada base de dados.
- [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](https://docs.microsoft.com/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan)

  Converte resultados de avaliação de vulnerabilidade para um ficheiro Excel

Para um exemplo de script, consulte o suporte PowerShell de avaliação de vulnerabilidade da [Vulnerabilidade Azure SQL](https://blogs.msdn.microsoft.com/sqlsecurity/20../../azure-sql-vulnerability-assessment-now-with-powershell-support/).

## <a name="manage-vulnerability-assessments-baseline-rules-using-resource-manager-templates"></a>Gerir as regras de base das avaliações de vulnerabilidade utilizando modelos de Gestor de Recursos

Para configurar as linhas de base de avaliação de vulnerabilidade utilizando modelos de Gestor de Recursos Azure, utilize o tipo `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines`.

Certifique-se de que ativou vulnerabilidades no computador que está a executar o SQL Server antes de adicionar as linhas de base.

Aqui está um exemplo para definir a Regra de Base VA2065 para masterdb e VA1143 userdb como recursos em um modelo de Gestor de Recursos:

```json
    "resources": [
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                                "FirewallRuleName3",
                                "StartIpAddress",
                                "EndIpAddress"
                                  ]
                    },{
                         "result": [
                                "FirewallRuleName4",
                                "62.92.15.68",
                                "62.92.15.68"
                            ]
                        
                    }
                ]
            },
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "dbo"
                        ]
                    }
                ]
            }
        }
    ]
}   
```

Para a base de dados do utilizador e base de dados principal, os nomes dos recursos são definidos de forma diferente:

* Base de dados principal - "nome": "[concat('server_name''/', parâmetros('database_name') , '/default/VA2065/<b>master']",</b>
* Base de dados do utilizador - "nome": "[concat('server_name'''/', parâmetros('database_name') , '/default/VA2065/<b>predefinido</b>')'",",
 
 
 Para lidar com os tipos <b>booleanos</b> como verdadeiros/falsos, detete o resultado da linha de base com uma entrada binária como "1"/"0".
 
 ```json
        {
            "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
            "apiVersion": "2018-06-01-preview",
            "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",
            "dependsOn": [
                "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
            ],
            "properties": {
                "baselineResults": [
                    {
                        "result": [
                            "1"
                        ]
                    }
                ]
            }
        }
    ]
}   
```
 
 
## <a name="next-steps"></a>Passos seguintes  

- Saiba mais sobre [segurança avançada de dados](sql-database-advanced-data-security.md)
- Saiba mais sobre [a descoberta e classificação](sql-database-data-discovery-and-classification.md) de dados
