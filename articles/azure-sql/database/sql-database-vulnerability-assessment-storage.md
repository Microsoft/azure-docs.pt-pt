---
title: A verificação da avaliação da vulnerabilidade da loja resulta numa conta de armazenamento acessível atrás de firewalls e VNets
description: Fornece instruções sobre como armazenar análises de vulnerabilidade (VA) numa conta de armazenamento que pode ser acedida através de uma firewall ou de um VNet
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 12/01/2020
ms.openlocfilehash: 83dbc04eb412d1e42fa8b42a3324c31a55db8adb
ms.sourcegitcommit: aacbf77e4e40266e497b6073679642d97d110cda
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 01/12/2021
ms.locfileid: "98116754"
---
# <a name="store-vulnerability-assessment-scan-results-in-a-storage-account-accessible-behind-firewalls-and-vnets"></a>A verificação da avaliação da vulnerabilidade da loja resulta numa conta de armazenamento acessível atrás de firewalls e VNets
[!INCLUDE[appliesto-sqldb-sqlmi](../includes/appliesto-sqldb-sqlmi.md)]

Se estiver a limitar o acesso à sua conta de armazenamento em Azure para determinados VNets ou serviços, terá de ativar a configuração adequada para que a avaliação de vulnerabilidade (VA) digitalize para bases de dados SQL ou Instâncias Geridas tenha acesso a essa conta de armazenamento.

## <a name="enable-azure-sql-database-va-scanning-access-to-the-storage-account"></a>Ativar o Azure SQL Database VA digitalizando o acesso à conta de armazenamento

Se configurar a sua conta de armazenamento va para estar acessível apenas por determinadas redes ou serviços, terá de garantir que as verificações de VA para a sua Base de Dados Azure SQL são capazes de armazenar as digitalizações na conta de armazenamento. Pode utilizar a conta de armazenamento existente ou criar uma nova conta de armazenamento para armazenar resultados de verificação de VA para todas as bases de dados no seu [servidor lógico SQL](logical-servers.md).

> [!NOTE]
> O serviço de avaliação de vulnerabilidades não pode aceder a contas de armazenamento protegidas com firewalls ou VNets se necessitarem de chaves de acesso ao armazenamento.

Vá ao seu **grupo de Recursos** que contenha a conta de armazenamento e aceda ao painel de conta de **Armazenamento.** Em **Definições**, selecione **Firewall e redes virtuais**.

Certifique-se de que permitir que **os serviços fidedignos da Microsoft tenham acesso a esta conta de armazenamento.**

:::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-allow-microsoft-services.png" alt-text="O Screenshot mostra firewall e caixa de diálogo de redes virtuais, com permitir que os serviços fidedignos da Microsoft acedam a esta conta de armazenamento selecionada.":::

Para saber que conta de armazenamento está a ser utilizada, aceda ao painel de **servidor SQL** no [portal Azure](https://portal.azure.com), em **Segurança**, selecione **Security Center**.

:::image type="content" source="../database/media/azure-defender-for-sql/va-storage.png" alt-text="estabelecer avaliação de vulnerabilidade":::

## <a name="store-va-scan-results-for-azure-sql-managed-instance-in-a-storage-account-that-can-be-accessed-behind-a-firewall-or-vnet"></a>Armazenar resultados de verificação va para Azure SQL Managed Instance em uma conta de armazenamento que pode ser acedido atrás de uma firewall ou VNet

Uma vez que o Caso Gerido não é um Serviço Microsoft de confiança e tem um VNet diferente da conta de armazenamento, executar uma verificação VA resultará num erro.

Para apoiar as análises de VA em Instâncias Geridas, siga os passos abaixo:

1. No painel de **instância gerido SQL,** sob o título **de visão geral,** clique na **rede Virtual/link de sub-rede.** Isto leva-o ao painel **de rede Virtual.**

   :::image type="content" source="../managed-instance/media/public-endpoint-configure/mi-overview.png" alt-text="mi-visão geral2":::

1. Em **Definições**, selecione **Sub-redes**. Clique na **Sub-rede** no novo painel para adicionar uma sub-rede e delegue-a à *Microsoft.sql\managedInstance*. Para obter mais informações, consulte [Gerir as sub-redes](../../virtual-network/virtual-network-manage-subnet.md).

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-subnets.png" alt-text="O Screenshot mostra uma sub-rede que foi delegada microsoft.sql\managedInstance.":::

1. No painel **de rede Virtual,** em **Definições,** selecione **pontos finais de serviço**. Clique em **Adicionar** o novo painel e adicione o *Serviço microsoft.storage* como um novo ponto final de serviço. Certifique-se de que *o sub-redes ManagedInstance* está selecionado. Clique em **Adicionar**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/mi-service-endpoint.png" alt-text="Screenshot mostra adicionar pontos finais de serviço, onde adiciona o Serviço microsoft.Storage como ponto final.":::

1. Vá à sua **conta de Armazenamento** que selecionou para armazenar os seus exames de VA. Em **Definições**, selecione **Firewall e redes virtuais**. Clique em **Adicionar rede virtual existente**. Selecione a sua rede virtual de instância gerida e sub-rede e clique em **Adicionar**.

   :::image type="content" source="media/sql-database-vulnerability-assessment-storage/storage-firewall.png" alt-text="O screenshot mostra o painel de firewalls e redes virtuais, que contém a ligação de rede virtual existente.":::

Deverá agora poder armazenar os seus exames de VA para Casos Geridos na sua conta de armazenamento.

## <a name="next-steps"></a>Passos seguintes

- [Avaliação de Vulnerabilidades](sql-vulnerability-assessment.md)
- [Criar uma conta de Armazenamento do Azure](../../storage/common/storage-account-create.md)
- [Azure Defender para SQL](azure-defender-for-sql.md)
