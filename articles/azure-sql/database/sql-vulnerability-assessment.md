---
title: Avaliação de Vulnerabilidades do SQL
titleSuffix: Azure SQL Database & SQL Managed Instance & Azure Synapse Analytics
description: Saiba como configurar a Avaliação de Vulnerabilidades SQL e interpretar os relatórios de avaliação sobre a Base de Dados Azure SQL, Azure SQL Managed Instance e Azure Synapse Analytics.
services: sql-database
ms.service: sql-db-mi
ms.subservice: security
ms.custom: sqldbrb=3
ms.devlang: ''
ms.topic: how-to
author: davidtrigano
ms.author: datrigan
ms.reviewer: vanto
ms.date: 09/21/2020
tags: azure-synapse
ms.openlocfilehash: 67258a19d1efe605a3a0b2227f107cc1928a207a
ms.sourcegitcommit: 8245325f9170371e08bbc66da7a6c292bbbd94cc
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 02/07/2021
ms.locfileid: "99806397"
---
# <a name="sql-vulnerability-assessment-helps-you-identify-database-vulnerabilities"></a>A Avaliação de Vulnerabilidades SQL ajuda-o a identificar vulnerabilidades de bases de dados
[!INCLUDE[appliesto-sqldb-sqlmi-asa](../includes/appliesto-sqldb-sqlmi-asa.md)]

A SQL Vulnerability Assessment é um serviço fácil de configurar que pode descobrir, rastrear e ajudar a corrigir potenciais vulnerabilidades de base de dados. Utilize-a para melhorar proativamente a segurança da base de dados.

A Avaliação de Vulnerabilidades faz parte da oferta do [Azure Defender para a oferta SQL,](azure-defender-for-sql.md) que é um pacote unificado para capacidades avançadas de segurança SQL. A Avaliação de Vulnerabilidade pode ser acedida e gerida através do Azure Defender central para o portal SQL.

> [!NOTE]
> A Avaliação de Vulnerabilidade é suportada para Azure SQL Database, Azure SQL Managed Instance e Azure Synapse Analytics. As bases de dados em Azure SQL Database, Azure SQL Managed Instance e Azure Synapse Analytics são referidas coletivamente no restante deste artigo como bases de dados, e o servidor refere-se ao [servidor](logical-servers.md) que acolhe bases de dados para Azure SQL Database e Azure Synapse.

## <a name="what-is-sql-vulnerability-assessment"></a>O que é a Avaliação de Vulnerabilidade SQL?

SQL Vulnerability Assessment é um serviço que proporciona visibilidade ao seu estado de segurança. A Avaliação de Vulnerabilidades inclui medidas accuáveis para resolver problemas de segurança e melhorar a segurança da sua base de dados. Pode ajudá-lo a monitorizar um ambiente dinâmico de base de dados onde as mudanças são difíceis de rastrear e melhorar a sua postura de segurança SQL.

A Avaliação de Vulnerabilidades é um serviço de digitalização integrado na Base de Dados Azure SQL. O serviço emprega uma base de conhecimento de regras que sinalizam vulnerabilidades de segurança. Destaca desvios das melhores práticas, tais como configurações erradas, permissões excessivas e dados sensíveis desprotegidos.

As regras baseiam-se nas melhores práticas da Microsoft e focam-se nos problemas de segurança que apresentam os maiores riscos para a sua base de dados e os seus dados valiosos. Cobrem problemas de nível de base de dados e problemas de segurança ao nível do servidor, como definições de firewall de servidor e permissões de nível de servidor.

Os resultados da digitalização incluem passos acccáveis para resolver cada problema e fornecer scripts de remediação personalizados, quando aplicável. Pode personalizar um relatório de avaliação para o seu ambiente definindo uma linha de base aceitável para:

- Configurações de permissão
- Configurações de recursos
- Definições de base de dados

## <a name="configure-vulnerability-assessment"></a>Configure avaliação da vulnerabilidade

Os seguintes passos configuram a avaliação da vulnerabilidade:

1. Aceda à sua Base de Dados Azure SQL, Base de Dados de Casos Geridos SQL ou recurso Azure Synapse no [portal Azure](https://portal.azure.com).

2. Sob a direção **de Segurança,** selecione **Security Center**.

3. Em **seguida,** clique em Configurar no link para abrir o painel de definições do Azure Defender para o painel de definições SQL para todo o servidor ou instância gerida.

    > [!NOTE]
    > A Avaliação de Vulnerabilidade SQL requer que **o Azure Defender para** o plano SQL seja capaz de executar digitalizações. Para obter mais informações sobre como ativar o Azure Defender para o SQL, consulte [o Azure Defender para SQL](azure-defender-for-sql.md).

4. Configure uma conta de armazenamento onde a sua verificação resulta de todas as bases de dados do servidor ou da instância gerida será armazenada. Para obter informações sobre contas de armazenamento, consulte [as contas de armazenamento da Azure.](../../storage/common/storage-account-create.md)

    > [!NOTE]
    > Para obter mais informações sobre o armazenamento de avaliações de vulnerabilidades por trás de firewalls e VNets, consulte os resultados da [avaliação da vulnerabilidade da loja numa conta de armazenamento acessível atrás de firewalls e VNets](sql-database-vulnerability-assessment-storage.md).

5. Configure a Avaliação de Vulnerabilidade SQL para executar automaticamente as análises periódicas recorrentes uma vez por semana para detetar qualquer alteração de segurança que se altere automaticamente. Para tal, ative **as verificações periódicas recorrentes** no âmbito da seleção da conta de armazenamento. Um resumo do resultado da verificação é enviado para os endereços de e-mail que fornece em **Enviar relatórios de digitalização para**. Também pode enviar notificação por e-mail aos administradores e proprietários de subscrições, permitindo **também enviar a notificação de e-mail aos administradores e proprietários de subscrições.**

6. A Avaliação de Vulnerabilidade SQL pode ser executada a pedido. Depois de configurar a Avaliação de Vulnerabilidades SQL, selecione **Scan** para verificar a sua base de dados para obter vulnerabilidades.

![Digitalize uma base de dados](./media/sql-vulnerability-assessment/pp_va_initialize.png)

  > [!NOTE]
  > A tomografia é leve e segura. Leva alguns segundos para correr e é inteiramente lido. Não faz alterações na sua base de dados.

## <a name="remediate-vulnerabilities"></a>Remediar vulnerabilidades

1. Quando a sua verificação estiver concluída, o seu relatório de digitalização é automaticamente apresentado no portal Azure. O relatório apresenta uma visão geral do seu estado de segurança. Ele enumera quantas questões foram encontradas e as respetivas severidades. Os resultados incluem avisos sobre desvios das melhores práticas e uma imagem das suas definições relacionadas com a segurança, tais como princípios e funções de base de dados, e as suas permissões associadas.

![Veja o relatório](./media/sql-vulnerability-assessment/pp_main_getstarted.png)

2. Reveja os seus resultados e determine as conclusões do relatório que são verdadeiras questões de segurança no seu ambiente. Aprofundar para cada resultado falhado para entender o impacto das descobertas e por que cada verificação de segurança falhou. Utilize as informações de reparação accitivas fornecidas pelo relatório para resolver as questões.

![Analisar o relatório](./media/sql-vulnerability-assessment/pp_fail_rule_show_remediation.png)

3. Ao rever os resultados da sua avaliação, pode marcar resultados específicos como sendo uma *linha de base* aceitável no seu ambiente. A linha de base é essencialmente uma personalização de como os resultados são relatados. Os resultados que correspondem à linha de base são considerados como passando em exames subsequentes. Depois de estabelecer o seu estado de segurança de base, a Avaliação de Vulnerabilidade apenas reporta desvios da linha de base. Desta forma, pode concentrar a sua atenção nas questões relevantes.

![Desa parte da linha de base](./media/sql-vulnerability-assessment/pp_fail_rule_show_baseline.png)

4. Depois de terminar a configuração das suas **Linhas de Base de Regras,** faça uma nova verificação para ver o relatório personalizado. A Avaliação de Vulnerabilidades reporta agora apenas os problemas de segurança que se desviam do seu estado de base aprovado.

![Veja o seu relatório personalizado](./media/sql-vulnerability-assessment/pp_pass_main_with_baselines.png)

A Avaliação de Vulnerabilidades pode agora ser usada para monitorizar que a sua base de dados mantém sempre um elevado nível de segurança e que as suas políticas organizacionais são cumpridas. 

## <a name="advanced-capabilities"></a>Capacidades avançadas

### <a name="export-an-assessment-report"></a>Exporte um relatório de avaliação

Selecione **Resultados da Verificação** de Exportação para criar um relatório excel descarregador do resultado da sua digitalização. Este relatório contém um separador sumário que apresenta um resumo da avaliação. O relatório inclui todos os controlos falhados. Também inclui um separador **resultados** que contém o conjunto completo de resultados da digitalização. Os resultados incluem todos os controlos que foram executados e os detalhes do resultado para cada um.

### <a name="view-scan-history"></a>Veja o histórico de análises

Selecione O Histórico de **Digitalização** no painel de avaliação de vulnerabilidades para visualizar um histórico de todas as verificações anteriormente executadas nesta base de dados. Selecione uma verificação específica na lista para visualizar os resultados detalhados dessa verificação.

## <a name="manage-vulnerability-assessments-programmatically"></a>Gerir avaliações de vulnerabilidade programáticamente

### <a name="using-azure-powershell"></a>Utilizar o Azure PowerShell

[!INCLUDE [updated-for-az](../../../includes/updated-for-az.md)]
> [!IMPORTANT]
> O módulo PowerShell Azure Resource Manager ainda é suportado, mas todo o desenvolvimento futuro é para o módulo Az.Sql. Para estes cmdlets, consulte [AzureRM.Sql](/powershell/module/AzureRM.Sql/). Os argumentos para os comandos no módulo Az e nos módulos AzureRm são substancialmente idênticos.

Pode utilizar cmdlets Azure PowerShell para gerir programaticamente as suas avaliações de vulnerabilidade. Os cmdlets suportados são:

| Nome cmdlet como ligação | Description |
| :-------------------- | :---------- |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Limpa a linha de base da regra de avaliação de vulnerabilidade.<br/>Primeiro, desa estada antes de utilizar este cmdlet para limpá-lo. |
| [Clear-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-azSqlDatabaseVulnerabilityAssessmentSetting) | Limpa as definições de Avaliação de Vulnerabilidade de uma base de dados. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Limpa a linha de base da regra de avaliação de vulnerabilidade de uma base de dados gerida.<br/>Primeiro, desa estada antes de utilizar este cmdlet para limpá-lo. |
| [Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Limpa as definições de Avaliação de Vulnerabilidade de uma base de dados gerida. |
| [Clear-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Clear-AzSqlInstanceVulnerabilityAssessmentSetting) | Limpa as definições de Avaliação de Vulnerabilidade de um caso gerido. |
| [Convert-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-azSqlDatabaseVulnerabilityAssessmentScan) | Converte os resultados da avaliação de vulnerabilidade de uma base de dados para um ficheiro Excel. |
| [Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Convert-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Converte resultados de avaliação de vulnerabilidade de uma base de dados gerida para um ficheiro Excel. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Obtém a regra de avaliação de vulnerabilidade de uma base de dados para uma determinada regra. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Obtém a base de referência da regra de avaliação de vulnerabilidade de uma base de dados gerida para uma determinada regra. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentScanRecord) | Obtém todos os registos de avaliação de vulnerabilidade associados a uma determinada base de dados. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentScanRecord) | Obtém todos os registos de avaliação de vulnerabilidade associados a uma determinada base de dados gerida. |
| [Get-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-azSqlDatabaseVulnerabilityAssessmentSetting) | Devolve as definições de Avaliação de Vulnerabilidade de uma base de dados. |
| [Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Get-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Devolve as definições de Avaliação de Vulnerabilidade de uma base de dados gerida. |
| [Set-AzSqlDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-azSqlDatabaseVulnerabilityAssessmentRuleBaseline) | Define a regra de avaliação de vulnerabilidade. |
| [Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline](/powershell/module/az.sql/Set-AzSqlInstanceDatabaseVulnerabilityAssessmentRuleBaseline) | Define a linha de base da regra de avaliação de vulnerabilidade para uma base de dados gerida. |
| [Start-AzSqlDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-azSqlDatabaseVulnerabilityAssessmentScan) | Desencadeia o início de uma avaliação de vulnerabilidade numa base de dados. |
| [Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan](/powershell/module/az.sql/Start-AzSqlInstanceDatabaseVulnerabilityAssessmentScan) | Desencadeia o início de uma avaliação de vulnerabilidade numa base de dados gerida. |
| [Atualização-AzSqlDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-azSqlDatabaseVulnerabilityAssessmentSetting) | Atualiza as definições de Avaliação de Vulnerabilidade de uma base de dados. |
| [Atualização-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceDatabaseVulnerabilityAssessmentSetting) | Atualiza as definições de Avaliação de Vulnerabilidade de uma base de dados gerida. |
| [Atualização-AzSqlInstanceVulnerabilityAssessmentSetting](/powershell/module/az.sql/Update-AzSqlInstanceVulnerabilityAssessmentSetting) | Atualiza as definições de Avaliação de Vulnerabilidade de um caso gerido. |
| &nbsp; | &nbsp; |

Para um exemplo de script, consulte [o suporte de avaliação de vulnerabilidades Azure SQL PowerShell](/archive/blogs/sqlsecurity/azure-sql-vulnerability-assessment-now-with-powershell-support).

### <a name="using-resource-manager-templates"></a>Utilizar modelos do Azure Resource Manager

Para configurar as linhas de base de avaliação de vulnerabilidades utilizando modelos de Gestor de Recursos Azure, utilize o `Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines` tipo.

Certifique-se de que ativou `vulnerabilityAssessments` antes de adicionar linhas de base.

Aqui está um exemplo para definir a Regra de Base VA2065 para base `master` de dados e VA1143 para base `user` de dados como recursos num modelo de Gestor de Recursos:

```json
   "resources": [
      {
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name') , '/default/VA2065/master')]",
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "FirewallRuleName3",
                     "StartIpAddress",
                     "EndIpAddress"
                  ]
               },
               {
                  "result": [
                     "FirewallRuleName4",
                     "62.92.15.68",
                     "62.92.15.68"
                  ]
               }
            ]
         },
         "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
         "apiVersion": "2018-06-01-preview",
         "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA2130/Default')]",
         "dependsOn": [
            "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
         ],
         "properties": {
            "baselineResults": [
               {
                  "result": [
                     "dbo"
                  ]
               }
            ]
         }
      }
   ]
```

Para `master` a base de dados e base de `user` dados, os nomes dos recursos são definidos de forma diferente:

- Base de dados principal - "nome": "[concat(parâmetros('server_name')'/', parâmetros('database_name') , '/default/VA2065/<b>master</b>')],»,
- Base de dados do utilizador - "nome": "[concat(parâmetros('server_name')'/', parâmetros('database_name') , '/predefinido/VA2065/<b>padrão</b>')],»,

Para manusear os tipos Boolean como verdadeiros/falsos, desafine o resultado da linha de base com a entrada binária como "1"/"0".

```json
   {
      "type": "Microsoft.Sql/servers/databases/vulnerabilityAssessments/rules/baselines",
      "apiVersion": "2018-06-01-preview",
      "name": "[concat(parameters('server_name'),'/', parameters('database_name'), '/default/VA1143/Default')]",

      "dependsOn": [
         "[resourceId('Microsoft.Sql/servers/vulnerabilityAssessments', parameters('server_name'), 'Default')]"
      ],

      "properties": {
         "baselineResults": [
            {
               "result": [
                  "1"
               ]
            }
         ]
      }

   }
```

## <a name="next-steps"></a>Passos seguintes  

- Saiba mais sobre [o Azure Defender para a SQL](azure-defender-for-sql.md).
- Saiba mais sobre [a descoberta e classificação de dados.](data-discovery-and-classification-overview.md)
- Saiba mais sobre [o armazenamento de avaliação de vulnerabilidades resulta numa conta de armazenamento acessível atrás de firewalls e VNets](sql-database-vulnerability-assessment-storage.md).
