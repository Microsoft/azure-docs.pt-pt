---
title: Microsoft antimalware para o Azure | Microsoft Docs
description: Este artigo fornece uma visão geral da arquitetura do Microsoft antimalware para o Azure, incluindo cenários e configurações com suporte para habilitar, configurar e implantar a proteção para serviços de nuvem e máquinas virtuais do Azure. Abordaremos a configuração básica, o gerenciamento e a funcionalidade de monitoramento acessíveis por meio de Microsoft Azure API de gerenciamento de serviços, scripts do PowerShell, o portal do Azure e o Visual Studio.
services: security
documentationcenter: na
author: barclayn
manager: barbkess
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.subservice: security-fundamentals
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/26/2019
ms.author: barclayn
ms.openlocfilehash: 2b0a8ff9160f5f311bbe3f74afcd4ff8eddf62f4
ms.sourcegitcommit: 85b3973b104111f536dc5eccf8026749084d8789
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 08/01/2019
ms.locfileid: "68727737"
---
# <a name="microsoft-antimalware-for-azure-cloud-services-and-virtual-machines"></a>Microsoft Antimalware for Azure Cloud Services and Virtual Machines

O Microsoft antimalware para Azure é uma proteção em tempo real gratuita que ajuda a identificar e remover vírus, spyware e outros softwares mal-intencionados. Ele gera alertas quando um software mal-intencionado ou indesejado conhecido tenta se instalar ou executar em seus sistemas do Azure.

A solução foi criada na mesma plataforma antimalware que o Microsoft Security Essentials \[MSE\], Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Windows Intune e Windows Defender. O Microsoft antimalware para Azure é uma solução de agente único para aplicativos e ambientes de locatário, projetada para ser executada em segundo plano sem intervenção humana. A proteção pode ser implantada com base nas necessidades de cargas de trabalho do aplicativo, com a configuração básica de segurança padrão ou avançada, incluindo o monitoramento antimalware.

Quando você implanta e habilita o Microsoft antimalware para o Azure para seus aplicativos, os seguintes recursos principais estão disponíveis:

* **Proteção em tempo real** – monitora a atividade em serviços de nuvem e em máquinas virtuais para detectar e bloquear a execução de malware.
* **Verificação agendada** – verifica periodicamente para detectar malware, incluindo programas ativamente em execução.
* **Correção de malware** -executa automaticamente a ação de malware detectado, como excluir ou colocar arquivos mal-intencionados em quarentena e limpar entradas de registro mal-intencionadas.
* **Atualizações de assinatura** – instala automaticamente as assinaturas de proteção mais recentes (definições de vírus) para garantir que a proteção esteja atualizada em uma frequência predeterminada.
* **Atualizações de antimalware Engine** – atualiza automaticamente o mecanismo Microsoft antimalware.
* **Atualizações de plataforma Antimalware** – atualiza automaticamente a plataforma antimalware da Microsoft.
* **Proteção ativa** – relata os metadados de telemetria sobre ameaças detectadas e recursos suspeitos para Microsoft Azure para garantir uma resposta rápida ao panorama de ameaças em evolução, bem como habilitar a entrega de assinatura síncrona em tempo real por meio do Microsoft Active Protection System (mapas).
* **Relatórios de exemplos** – fornece e relata exemplos para o serviço Microsoft antimalware para ajudar a refinar o serviço e a habilitar a solução de problemas.
* **Exclusões** – permite que os administradores de aplicativos e serviços configurem exclusões para arquivos, processos e unidades.  
* **Coleção de eventos Antimalware** -registra a integridade do serviço Antimalware, as atividades suspeitas e as ações de correção executadas no log de eventos do sistema operacional e as coleta na conta de armazenamento do Azure do cliente.

> [!NOTE]
> O Microsoft Antimalware também pode ser implantado usando a central de segurança do Azure. Leia [instalar Endpoint Protection na central de segurança do Azure](../../security-center/security-center-install-endpoint-protection.md) para obter mais informações.

## <a name="architecture"></a>Arquitetura

O Microsoft antimalware para Azure inclui o cliente e o serviço Microsoft Antimalware, o modelo de implantação clássico Antimalware, os cmdlets do PowerShell antimalware e a extensão Diagnóstico do Azure. O Microsoft Antimalware tem suporte nas famílias do sistema operacional Windows Server 2008 R2, Windows Server 2012 e Windows Server 2012 R2. Não há suporte para ele no sistema operacional Windows Server 2008 e também não tem suporte no Linux.

O cliente e serviço Microsoft antimalware é instalado por padrão em um estado desabilitado em todas as famílias de sistema operacional convidado do Azure com suporte na plataforma de serviços de nuvem. O cliente e o serviço Microsoft Antimalware não são instalados por padrão na plataforma de máquinas virtuais e está disponível como um recurso opcional por meio da configuração de máquina virtual do portal do Azure e do Visual Studio em extensões de segurança.

Ao usar o serviço Azure App, o serviço subjacente que hospeda o aplicativo Web tem o Microsoft Antimalware habilitado nele. Isso é usado para proteger Azure App infraestrutura de serviço e não é executado no conteúdo do cliente.

> [!NOTE]
> O Windows Defender é o antimalware interno habilitado no Windows Server 2016. A interface do Windows Defender também é habilitada por padrão em alguns SKU do Windows Server 2016 [Consulte aqui para obter mais informações](https://docs.microsoft.com/windows/threat-protection/windows-defender-antivirus/windows-defender-antivirus-on-windows-server-2016). A extensão antimalware de VM do Azure ainda pode ser adicionada a uma VM do Azure do Windows Server 2016 com o Windows Defender, mas nesse cenário a extensão aplicará quaisquer [políticas de configuração](https://gallery.technet.microsoft.com/Antimalware-For-Azure-5ce70efe) opcionais a serem usadas pelo Windows Defender, a extensão não implantará nenhuma serviços Antimalware adicionais.
> Você pode ler mais sobre essa atualização [aqui](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/).

### <a name="microsoft-antimalware-workflow"></a>Fluxo de trabalho de antimalware da Microsoft

O administrador de serviços do Azure pode habilitar o antimalware para o Azure com uma configuração padrão ou personalizada para suas máquinas virtuais e serviços de nuvem usando as seguintes opções:

* Máquinas virtuais – no portal do Azure, em **extensões de segurança**
* Máquinas virtuais – usando a configuração de máquinas virtuais do Visual Studio no Gerenciador de Servidores
* Máquinas virtuais e serviços de nuvem – usando o [modelo de implantação clássico](https://msdn.microsoft.com/library/azure/ee460799.aspx) Antimalware
* Máquinas virtuais e serviços de nuvem – usando cmdlets do PowerShell de antimalware

Os cmdlets portal do Azure ou PowerShell enviam por push o arquivo de pacote de extensão antimalware para o sistema do Azure em um local fixo predeterminado. O agente convidado do Azure (ou o agente de malha) inicia a extensão Antimalware, aplicando as definições de configuração de antimalware fornecidas como entrada. Esta etapa habilita o serviço Antimalware com definições de configuração padrão ou personalizadas. Se nenhuma configuração personalizada for fornecida, o serviço Antimalware será habilitado com as definições de configuração padrão. Consulte a seção *configuração* de antimalware no [Microsoft antimalware para Azure – exemplos de código](https://aka.ms/amazsamples "Microsoft antimalware para serviços de nuvem do Azure e exemplos de código de VMs") para obter mais detalhes.

Uma vez em execução, o cliente Microsoft Antimalware baixa as definições de assinatura e o mecanismo de proteção mais recentes da Internet e as carrega no sistema do Azure. O serviço de antimalware da Microsoft grava eventos relacionados ao serviço no log de eventos do sistema operacional na origem do evento "Microsoft AntiMalware". Os eventos incluem o estado de integridade do cliente Antimalware, o status de proteção e correção, definições de configuração novas e antigas, atualizações de mecanismo e definições de assinatura, entre outros.

Você pode habilitar o monitoramento antimalware para seu serviço de nuvem ou máquina virtual para que os eventos do log de eventos de antimalware sejam gravados conforme eles são produzidos para sua conta de armazenamento do Azure. O serviço Antimalware usa a extensão Diagnóstico do Azure para coletar eventos antimalware do sistema do Azure para tabelas na conta de armazenamento do Azure do cliente.

O fluxo de trabalho de implantação, incluindo etapas de configuração e opções com suporte para os cenários acima, está documentado na seção [cenários de implantação](#antimalware-deployment-scenarios) de antimalware deste documento.

![Microsoft Antimalware no Azure](./media/antimalware/sec-azantimal-fig1.PNG)

> [!NOTE]
> No entanto, você pode usar o PowerShell/APIs e modelos de Azure Resource Manager para implantar conjuntos de dimensionamento de máquinas virtuais com a extensão antimalware da Microsoft.  Para instalar uma extensão em uma máquina virtual já em execução, você pode usar o script Python de exemplo [vmssextn.py](https://github.com/gbowerman/vmsstools). Esse script Obtém a configuração de extensão existente no conjunto de dimensionamento e adiciona uma extensão à lista de extensões existentes nos conjuntos de dimensionamento de VM.
>
>

### <a name="default-and-custom-antimalware-configuration"></a>Configuração de antimalware padrão e personalizada

As definições de configuração padrão são aplicadas para habilitar o antimalware para os serviços de nuvem do Azure ou para máquinas virtuais quando você não fornece definições de configuração personalizadas. As definições de configuração padrão foram previamente otimizadas para execução no ambiente do Azure. Opcionalmente, você pode personalizar essas configurações padrão conforme necessário para a implantação de seu aplicativo ou serviço do Azure e aplicá-las a outros cenários de implantação.

A tabela a seguir resume as definições de configuração disponíveis para o serviço antimalware. As definições de configuração padrão são marcadas na coluna rotulada "padrão" abaixo.

![Tabela 1](./media/antimalware/sec-azantimal-tb18.PNG)

## <a name="antimalware-deployment-scenarios"></a>Cenários de implantação Antimalware

Os cenários para habilitar e configurar o antimalware, incluindo o monitoramento de serviços de nuvem do Azure e máquinas virtuais, são discutidos nesta seção.

### <a name="virtual-machines---enable-and-configure-antimalware"></a>Máquinas virtuais – habilitar e configurar o antimalware

#### <a name="deployment-while-creating-a-vm-using-the-azure-portal"></a>Implantação ao criar uma VM usando o portal do Azure

Para habilitar e configurar o Microsoft antimalware para máquinas virtuais do Azure usando o portal do Azure ao provisionar uma máquina virtual, siga as etapas abaixo:

1. Inicie sessão no portal do Azure em <https://portal.azure.com>.
2. Para criar uma nova máquina virtual, navegue até **máquinas virtuais**, selecione **Adicionar**e escolha **Windows Server**.
3. Selecione a versão do Windows Server que você deseja usar.
4. Selecione **Criar**.
    ![Criar máquina virtual](./media/antimalware/create-vm.PNG)
5. Forneça um **nome**, **nome de usuário**, **senha**e crie um novo grupo de recursos ou escolha um grupo de recursos existente.
6. Selecione **Ok**.
7. Escolha um tamanho de VM.
8. Na próxima seção, faça as escolhas apropriadas para suas necessidades e selecione a seção **extensões** .
9. Selecione **adicionar extensão**
10. Em **novo recurso**, escolha **Microsoft Antimalware**.
11. Selecione **Criar**
12. No arquivo da seção de **extensão de instalação** , locais e exclusões de processo podem ser configurados, bem como outras opções de verificação. Selecione **OK**.
13. Selecione **OK**.
14. De volta à seção **configurações** , escolha **OK**.
15. Na tela **criar** , escolha **OK**.

#### <a name="deployment-using-the-visual-studio-virtual-machine-configuration"></a>Implantação usando a configuração de máquina virtual do Visual Studio

Para habilitar e configurar o serviço Microsoft Antimalware usando o Visual Studio:

1. Conecte-se a Microsoft Azure no Visual Studio.

2. Escolha sua máquina virtual no nó **máquinas virtuais** no **Gerenciador de servidores**

   ![Configuração de máquina virtual no Visual Studio](./media/antimalware/sec-azantimal-fig5.PNG)

3. Clique com o botão direito do mouse em **Configurar** para exibir a página de configuração da máquina virtual

4. Selecione extensão de antimalware da **Microsoft** na lista suspensa em **extensões instaladas** e clique em **Adicionar** para configurar com a configuração Antimalware padrão.
    ![Extensões instaladas](./media/antimalware/sec-azantimal-fig6.PNG)
5. Para personalizar a configuração de antimalware padrão, selecione (realce) a extensão Antimalware na lista de extensões instaladas e clique em **Configurar**.

6. Substitua a configuração de antimalware padrão por sua configuração personalizada no formato JSON com suporte na caixa de texto **configuração pública** e clique em OK.

7. Clique no botão **Atualizar** para enviar por push as atualizações de configuração para sua máquina virtual.

    ![Extensão de configuração de máquina virtual](./media/antimalware/sec-azantimal-fig7.PNG)

> [!NOTE]
>A configuração de máquinas virtuais do Visual Studio para antimalware dá suporte apenas à configuração de formato JSON. O modelo de definições de configuração de antimalware JSON está incluído no [Microsoft antimalware para Azure-exemplos de código](https://aka.ms/amazsamples "Microsoft antimalware para Azure-exemplos de código"), mostrando as definições de configuração de antimalware com suporte.

#### <a name="deployment-using-powershell-cmdlets"></a>Implantação usando cmdlets do PowerShell

Um aplicativo ou serviço do Azure pode habilitar e configurar o Microsoft antimalware para máquinas virtuais do Azure usando cmdlets do PowerShell.

Para habilitar e configurar o Microsoft Antimalware usando cmdlets do PowerShell de AntiMalware:

1. Configurar o ambiente do PowerShell-consulte a documentação em<https://github.com/Azure/azure-powershell>
2. Use o [cmdlet Antimalware Set-AzureVMMicrosoftAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurevmmicrosoftantimalwareextension) para habilitar e configurar o Microsoft antimalware para sua máquina virtual.

> [!NOTE]
>A configuração de máquinas virtuais do Azure para antimalware dá suporte apenas à configuração de formato JSON. O modelo de definições de configuração de antimalware JSON está incluído no [Microsoft antimalware para Azure-exemplos de código](https://aka.ms/amazsamples "Microsoft antimalware para Azure-exemplos de código"), mostrando as definições de configuração de antimalware com suporte.

### <a name="enable-and-configure-antimalware-using-powershell-cmdlets"></a>Habilitar e configurar o antimalware usando cmdlets do PowerShell

Um aplicativo ou serviço do Azure pode habilitar e configurar o Microsoft antimalware para serviços de nuvem do Azure usando cmdlets do PowerShell. Observe que o Microsoft Antimalware está instalado em um estado desabilitado na plataforma de serviços de nuvem e requer uma ação por um aplicativo do Azure para habilitá-lo.

Para habilitar e configurar o Microsoft Antimalware usando cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell-consulte a documentação em<https://github.com/Azure/azure-powershell>
2. Use o [cmdlet Antimalware Set-AzureServiceAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension) para habilitar e configurar o Microsoft antimalware para seu serviço de nuvem.

O modelo de definições de configuração de antimalware XML está incluído no [Microsoft antimalware para Azure-exemplos de código](https://aka.ms/amazsamples "Microsoft antimalware para Azure-exemplos de código"), mostrando as definições de configuração de antimalware com suporte.

### <a name="cloud-services-and-virtual-machines---configuration-using-powershell-cmdlets"></a>Serviços de nuvem e máquinas virtuais – configuração usando cmdlets do PowerShell

Um aplicativo ou serviço do Azure pode recuperar a configuração de antimalware da Microsoft para serviços de nuvem e máquinas virtuais usando cmdlets do PowerShell.

Para recuperar a configuração de antimalware da Microsoft usando cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell-consulte a documentação em<https://github.com/Azure/azure-powershell>
2. **Para máquinas virtuais**: Use o [cmdlet getmalware Get-AzureVMMicrosoftAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/get-azurevmmicrosoftantimalwareextension) para obter a configuração de antimalware.
3. **Para serviços de nuvem**: Use o [cmdlet getmalware Get-AzureServiceAntimalwareConfig](https://docs.microsoft.com/powershell/module/servicemanagement/azure/get-azureserviceantimalwareconfig) para obter a configuração de antimalware.

### <a name="remove-antimalware-configuration-using-powershell-cmdlets"></a>Remover configuração de antimalware usando cmdlets do PowerShell

Um aplicativo ou serviço do Azure pode remover a configuração de antimalware e qualquer configuração de monitoramento de antimalware associada das extensões relevantes do serviço de diagnóstico e antimalware do Azure associadas ao serviço de nuvem ou à máquina virtual.

Para remover o Microsoft Antimalware usando cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell-consulte a documentação em<https://github.com/Azure/azure-powershell>
2. **Para máquinas virtuais**: Use o [cmdlet de antimalware remove-AzureVMMicrosoftAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/remove-azurevmmicrosoftantimalwareextension).
3. **Para serviços de nuvem:** Use o [cmdlet de antimalware remove-AzureServiceAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/remove-azureserviceantimalwareextension).

Para **habilitar** a coleta de eventos antimalware para uma máquina virtual usando o portal de visualização do Azure:

1. Clique em qualquer parte da lente de monitoramento na folha da máquina virtual
2. Clique no comando diagnóstico na folha métrica
3. Selecione **status** em e marque a opção sistema de eventos do Windows
4. . Você pode optar por desmarcar todas as outras opções na lista ou deixá-las habilitadas de acordo com as necessidades do serviço de aplicativo.
5. As categorias de evento de AntiMalware "erro", "aviso", "informativo", etc., são capturadas em sua conta de armazenamento do Azure.

Os eventos Antimalware são coletados dos logs do sistema de eventos do Windows para sua conta de armazenamento do Azure. Você pode configurar a conta de armazenamento para sua máquina virtual para coletar eventos Antimalware selecionando a conta de armazenamento apropriada.

![Métricas e diagnósticos](./media/antimalware/sec-azantimal-fig8.PNG)

> [!NOTE]
> Para obter mais informações sobre como registrar em log o diagnóstico do Azure Antimalware, leia habilitando o [log de diagnóstico para o antimalware do Azure](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/).

### <a name="enable-and-configure-antimalware-monitoring-using-powershell-cmdlets"></a>Habilitar e configurar o monitoramento de antimalware usando cmdlets do powerShell

Você pode habilitar a coleta de eventos antimalware da Microsoft para seu serviço de nuvem ou máquina virtual usando Diagnóstico do Azure por meio de cmdlets do PowerShell antimalware. A extensão Diagnóstico do Azure pode ser configurada para capturar eventos da origem do log de eventos do sistema "Microsoft AntiMalware" para sua conta de armazenamento do Azure. As categorias de evento de AntiMalware "erro", "aviso", "informativo", etc., são capturadas em sua conta de armazenamento do Azure.

Para habilitar a coleta de eventos antimalware para sua conta de armazenamento do Azure usando cmdlets do PowerShell:

1. Configurar o ambiente do PowerShell-consulte<https://github.com/Azure/azure-powershell>
2. **Para máquinas virtuais** -use o [cmdlet Antimalware Set-AzureVMMicrosoftAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azurevmmicrosoftantimalwareextension) com a opção monitoramento ativado.
3. **Para serviços de nuvem** -use o [cmdlet Antimalware Set-AzureServiceAntimalwareExtension](https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension) com a opção monitoramento ativado.

Você pode exibir os eventos brutos Antimalware examinando a tabela *WADWindowsEventLogsTable* em sua conta de armazenamento do Azure que você configurou para habilitar o monitoramento antimalware. Isso pode ser útil para validar que a coleta de eventos Antimalware está funcionando, incluindo a obtenção de informações sobre a integridade do serviço antimalware. Para obter mais informações, incluindo o código de exemplo sobre como extrair eventos antimalware de sua conta de armazenamento, consulte [Microsoft antimalware para Azure-exemplos de código](https://aka.ms/amazsamples "Microsoft antimalware para Azure – exemplos de código").
