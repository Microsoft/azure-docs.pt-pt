---
title: Microsoft Antimalware para Azure Microsoft Docs
description: Saiba mais sobre o Microsoft Antimalware para serviços em nuvem Azure e máquinas virtuais. Consulte informações sobre temas como arquitetura e cenários de implantação.
services: security
documentationcenter: na
author: terrylanfear
manager: barbkess
editor: ''
ms.assetid: 265683c8-30d7-4f2b-b66c-5082a18f7a8b
ms.service: security
ms.subservice: security-fundamentals
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 03/26/2019
ms.author: terrylan
ms.openlocfilehash: 34aedbe20a9548977d6cc3b4ccca1a7a111f5550
ms.sourcegitcommit: 32c521a2ef396d121e71ba682e098092ac673b30
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 09/25/2020
ms.locfileid: "91322109"
---
# <a name="microsoft-antimalware-for-azure-cloud-services-and-virtual-machines"></a>Microsoft Antimalware para Azure Cloud Services e Máquinas Virtuais

O Microsoft Antimalware for Azure é uma proteção gratuita em tempo real que ajuda a identificar e remover vírus, spyware e outros softwares maliciosos. Gera alertas quando um software malicioso ou indesejado conhecido tenta instalar-se ou funcionar nos seus sistemas Azure.

A solução é construída na mesma plataforma antimalware que o Microsoft Security Essentials \[ \] MSE, Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Microsoft Intune e Microsoft Defender. O Microsoft Antimalware for Azure é uma solução de agente único para aplicações e ambientes de inquilinos, projetado para funcionar em segundo plano sem intervenção humana. A proteção pode ser implementada com base nas necessidades das cargas de trabalho da aplicação, com uma configuração personalizada básica segura por defeito ou avançada, incluindo a monitorização antimalware.

Quando implementa e ativa o Microsoft Antimalware para Azure para as suas aplicações, estão disponíveis as seguintes funcionalidades principais:

* **Proteção** em tempo real - monitoriza a atividade nos Serviços cloud e em Máquinas Virtuais para detetar e bloquear a execução de malware.
* **Digitalização programada** - Digitaliza periodicamente para detetar malware, incluindo programas de execução ativa.
* **Remediação de malware** - toma automaticamente medidas sobre malware detetado, como eliminar ou quarentena de ficheiros maliciosos e limpar entradas de registo maliciosos.
* **Atualizações de assinaturas** - instala automaticamente as assinaturas de proteção mais recentes (definições de vírus) para garantir que a proteção está atualizada numa frequência pré-determinada.
* **Atualizações do Antimalware Engine** – atualiza automaticamente o motor antimalware da Microsoft.
* **Atualizações da Plataforma antimalware** – atualiza automaticamente a plataforma antimalware da Microsoft.
* **Ative protection** - reporta metadados de telemetria sobre ameaças detetadas e recursos suspeitos para o Microsoft Azure para garantir uma resposta rápida ao cenário de ameaças em evolução, bem como permitir a entrega de assinatura sincronizada em tempo real através do Microsoft Ative Protection System (MAPS).
* **Relatório de amostras** - fornece e reporta amostras ao serviço de Antimalware da Microsoft para ajudar a refinar o serviço e permitir a resolução de problemas.
* **Exclusões** – permite que os administradores de aplicações e serviços configurem exclusões para ficheiros, processos e unidades.  
* **Antimalware event collection** - registra a saúde do serviço antimalware, atividades suspeitas e ações de remediação tomadas no registo de eventos do sistema operativo e recolhe-as na conta de Armazenamento Azure do cliente.

> [!NOTE]
> O Microsoft Antimalware também pode ser implementado usando o Azure Security Center. Leia [a proteção do ponto de ponta no Centro de Segurança Azure](../../security-center/security-center-install-endpoint-protection.md) para obter mais informações.

## <a name="architecture"></a>Arquitetura

O Microsoft Antimalware for Azure inclui o Cliente e Serviço de Antimalware da Microsoft, o modelo de implementação clássica antimalware, os cmdlets Antimalware PowerShell e a extensão de diagnóstico azure. O Microsoft Antimalware é suportado nas famílias do sistema operativo Windows Server 2008 R2, Windows Server 2012 e Windows Server 2012 R2. Não é suportado no sistema operativo Windows Server 2008, e também não é suportado no Linux.

O Microsoft Antimalware Client and Service é instalado por padrão num estado desativado em todas as famílias suportadas do sistema operativo Azure na plataforma Cloud Services. O Cliente e Serviço de Antimalware da Microsoft não está instalado por padrão na plataforma Máquinas Virtuais e está disponível como uma funcionalidade opcional através do portal Azure e da configuração da Máquina Virtual do Estúdio Visual em Extensões de Segurança.

Ao utilizar o Azure App Service no Windows, o serviço subjacente que acolhe a aplicação web tem o Microsoft Antimalware ativado no mesmo. Isto é usado para proteger a infraestrutura do Azure App Service e não funciona com conteúdo do cliente.

> [!NOTE]
> O Microsoft Defender é o Antimalware incorporado ativado no Windows Server 2016. A Interface do Microsoft Defender também é ativada por padrão em alguns SKU do Windows Server 2016 [para mais informações](https://docs.microsoft.com/windows/threat-protection/windows-defender-antivirus/windows-defender-antivirus-on-windows-server-2016). A extensão de Antimalware Azure VM ainda pode ser adicionada a um Windows Server 2016 Azure VM com o Microsoft Defender, mas neste cenário a extensão aplicará quaisquer políticas de [configuração](https://gallery.technet.microsoft.com/Antimalware-For-Azure-5ce70efe) opcionais a serem utilizadas pelo Microsoft Defender, a extensão não irá implementar quaisquer serviços antimalware adicionais.
> Pode ler mais sobre esta atualização [aqui.](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/)

### <a name="microsoft-antimalware-workflow"></a>Fluxo de trabalho antimalware da Microsoft

O administrador de serviçoS Azure pode ativar o Antimalware para Azure com uma configuração padrão ou personalizada para as suas Máquinas Virtuais e Serviços cloud utilizando as seguintes opções:

* Máquinas Virtuais – No portal Azure, sob **extensões de segurança**
* Máquinas Virtuais – Utilização da configuração de máquinas virtuais do Estúdio Visual no Explorador de Servidores
* Máquinas virtuais e serviços em nuvem – usando o [modelo de implementação clássica](https://msdn.microsoft.com/library/azure/ee460799.aspx) de Antimalware
* Máquinas virtuais e serviços em nuvem – usando cmdlets PowerShell antimalware

O portal Azure ou os cmdlets PowerShell empurram o ficheiro de extensão Antimalware para o sistema Azure num local fixo pré-determinado. O Agente Convidado Azure (ou Agente de Tecido) lança a Extensão antimalware, aplicando as definições de configuração antimalware fornecidas como entrada. Este passo permite o serviço Antimalware com definições de configuração padrão ou personalizadas. Se não for fornecida nenhuma configuração personalizada, o serviço antimalware está ativado com as definições de configuração predefinidos. Consulte a secção *de configuração antimalware* no [Microsoft Antimalware para Azure – Code Samples](https://aka.ms/amazsamples "Antimalware da Microsoft para serviços em nuvem azure e amostras de código VMs") para obter mais detalhes.

Uma vez em funcionamento, o cliente da Microsoft Antimalware descarrega as definições mais recentes do motor de proteção e assinatura da Internet e carrega-as no sistema Azure. O serviço Microsoft Antimalware escreve eventos relacionados com o serviço para os eventos do sistema OS iniciar sessão sob a fonte de evento "Microsoft Antimalware". Os eventos incluem o estado de saúde do cliente antimalware, estado de proteção e reparação, configurações novas e antigas, atualizações do motor e definições de assinatura, entre outros.

Pode ativar a monitorização do Antimalware para o seu Serviço de Cloud ou Máquina Virtual para que os eventos de registo de eventos antimalware sejam escritos à medida que forem produzidos na sua conta de armazenamento Azure. O Serviço antimalware utiliza a extensão Azure Diagnostics para recolher eventos antimalware do sistema Azure em tabelas na conta de Armazenamento Azure do cliente.

O fluxo de trabalho de implementação, incluindo etapas de configuração e opções suportadas para os cenários acima referidos, estão documentados na secção de cenários de implantação de [Antimalware](#antimalware-deployment-scenarios) deste documento.

![Microsoft Antimalware no Azure](./media/antimalware/sec-azantimal-fig1.PNG)

> [!NOTE]
> No entanto, pode utilizar os modelos Powershell/APIs e Azure Resource Manager para implementar conjuntos de escala de máquina virtual com a extensão anti-malware da Microsoft.  Para instalar uma extensão numa Máquina Virtual já em funcionamento, pode utilizar o script de pitão de amostra [vmssextn.py](https://github.com/gbowerman/vmsstools). Este script obtém a configuração de extensão existente no Conjunto de Escala e adiciona uma extensão à lista de extensões existentes nos conjuntos de escala VM.
>
>

### <a name="default-and-custom-antimalware-configuration"></a>Configuração de antimalware padrão e personalizado

As definições de configuração predefinida são aplicadas para ativar antimalware para Serviços de Nuvem Azure ou Máquinas Virtuais quando não fornece configurações de configuração personalizadas. As definições de configuração predefinidas foram pré-otimizadas para correr no ambiente Azure. Opcionalmente, pode personalizar estas definições de configuração predefinidas conforme necessário para a sua aplicação ou implementação de serviço Azure e aplicá-las para outros cenários de implementação.

A tabela seguinte resume as definições de configuração disponíveis para o serviço Antimalware. As definições de configuração predefinidas estão marcadas sob a coluna rotulada "Predefinido" abaixo.

![Tabela 1](./media/antimalware/sec-azantimal-tb18.PNG)

## <a name="antimalware-deployment-scenarios"></a>Cenários de implantação de antimalware

Os cenários para permitir e configurar antimalware, incluindo monitorização para Azure Cloud Services e Máquinas Virtuais, são discutidos nesta secção.

### <a name="virtual-machines---enable-and-configure-antimalware"></a>Máquinas virtuais - ativar e configurar antimalware

#### <a name="deployment-while-creating-a-vm-using-the-azure-portal"></a>Implantação Ao criar um VM utilizando o portal Azure

Para ativar e configurar o Antimalware da Microsoft para máquinas virtuais Azure utilizando o portal Azure enquanto fornece uma Máquina Virtual, siga os passos abaixo:

1. Inicie sessão no portal do Azure em <https://portal.azure.com>.
2. Para criar uma nova máquina virtual, navegue para **máquinas Virtuais,** selecione **Add**, e escolha **o Windows Server**.
3. Selecione a versão do servidor Windows que gostaria de utilizar.
4. Selecione **Criar**.
    ![Criar a máquina virtual](./media/antimalware/create-vm.PNG)
5. Forneça um **Nome,** **Nome de Utilizador,** **Password,** e crie um novo grupo de recursos ou escolha um grupo de recursos existente.
6. Selecione **OK**.
7. Escolha um tamanho VM.
8. Na secção seguinte, faça as escolhas adequadas para as suas necessidades selecione a secção **Extensões.**
9. Selecione **Adicionar extensão**
10. Sob **novo recurso,** escolha **o Microsoft Antimalware**.
11. Selecione **Criar**
12. No ficheiro de **secção de extensão de instalação,** as localizações e as exclusões de processo podem ser configuradas, bem como outras opções de digitalização. Escolha **Ok**.
13. Escolha **Ok**.
14. De volta à secção **Definições,** escolha **Ok**.
15. No ecrã **Criar,** escolha **Ok**.

#### <a name="deployment-using-the-visual-studio-virtual-machine-configuration"></a>Implementação utilizando a configuração da máquina virtual do Estúdio Visual

Para ativar e configurar o serviço de antimalware da Microsoft utilizando o Visual Studio:

1. Ligue-se ao Microsoft Azure em Visual Studio.

2. Escolha a sua máquina virtual no nó **de máquinas virtuais** no **Explorador de Servidor**

   ![Configuração de máquina virtual no Estúdio Visual](./media/antimalware/sec-azantimal-fig5.PNG)

3. Configuração **configure** de clique à direita para ver a página de configuração da Máquina Virtual

4. Selecione a extensão **do Antimalware** da Microsoft a partir da lista de dropdown em **Extensões Instaladas** e clique em **Adicionar** para configurar com configuração antimalware predefinida.
    ![Extensões instaladas](./media/antimalware/sec-azantimal-fig6.PNG)
5. Para personalizar a configuração antimalware predefinida, selecione (realçar) a extensão antimalware na lista de extensões instaladas e clique em **Configurar**.

6. Substitua a configuração antimalware predefinida pela sua configuração personalizada no formato JSON suportado na caixa de texto de **configuração pública** e clique em OK.

7. Clique no botão **'Actualizar'** para premir as atualizações de configuração para a sua Máquina Virtual.

    ![Extensão de configuração da máquina virtual](./media/antimalware/sec-azantimal-fig7.PNG)

> [!NOTE]
>A configuração de Máquinas Virtuais do Estúdio Visual para Antimalware suporta apenas a configuração do formato JSON. O modelo de configuração antimalware JSON está incluído no [Antimalware da Microsoft Para Azure - Amostras de código](https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Amostras de código"), mostrando as definições de configuração antimalware suportadas.

#### <a name="deployment-using-powershell-cmdlets"></a>Implantação utilizando cmdlets PowerShell

Uma aplicação ou serviço Azure pode permitir e configurar o Microsoft Antimalware para Máquinas Virtuais Azure utilizando cmdlets PowerShell.

Para ativar e configurar o antimalware da Microsoft utilizando cmdlets antimalware PowerShell:

1. Configurar o seu ambiente PowerShell - Consulte a documentação em <https://github.com/Azure/azure-powershell>
2. Utilize o [Set-AzureVMMicrosoftAntimalwareExtension Antimalware cmdlet]/powershell/module/servicemanagement/azure.service/set-azurevmmicrosoftanalwareextension) para ativar e configurar o Antimalware da Microsoft para a sua Máquina Virtual.

> [!NOTE]
>A configuração Azure Virtual Machines para Antimalware suporta apenas a configuração do formato JSON. O modelo de configuração antimalware JSON está incluído no [Antimalware da Microsoft Para Azure - Amostras de código](https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Amostras de código"), mostrando as definições de configuração antimalware suportadas.

### <a name="enable-and-configure-antimalware-using-powershell-cmdlets"></a>Ativar e Configurar antimalware usando cmdlets PowerShell

Uma aplicação ou serviço Azure pode permitir e configurar o Microsoft Antimalware para serviços de nuvem Azure utilizando cmdlets PowerShell. Note que o Microsoft Antimalware está instalado num estado desativado na plataforma Cloud Services e requer uma ação através de uma aplicação Azure para o permitir.

Para ativar e configurar o Microsoft Antimalware utilizando cmdlets PowerShell:

1. Configurar o seu ambiente PowerShell - Consulte a documentação em <https://github.com/Azure/azure-powershell>
2. Utilize o [Cmdlet Antimalware Antimalware Set-AzureServiceAntimalwareextension](/powershell/module/servicemanagement/azure.service/set-azureserviceantimalwareextension) para ativar e configurar o Microsoft Antimalware para o seu Serviço cloud.

O modelo de configuração antimalware XML está incluído no [Antimalware da Microsoft Para Azure - Amostras de código](https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Amostras de código"), mostrando as definições de configuração antimalware suportadas.

### <a name="cloud-services-and-virtual-machines---configuration-using-powershell-cmdlets"></a>Serviços em nuvem e máquinas virtuais - Configuração usando cmdlets PowerShell

Uma aplicação ou serviço Azure pode recuperar a configuração do Microsoft Antimalware para serviços em nuvem e máquinas virtuais utilizando cmdlets PowerShell.

Para recuperar a configuração do Microsoft Antimalware utilizando cmdlets PowerShell:

1. Configurar o seu ambiente PowerShell - Consulte a documentação em <https://github.com/Azure/azure-powershell>
2. **Para máquinas virtuais**: Utilize o [cmdlet Antimalware Deexware Get-AzureVMMicrosoftAntimalware Para](/powershell/module/servicemanagement/azure.service/get-azurevmmicrosoftantimalwareextension) obter a configuração antimalware.
3. **Para serviços na nuvem**: Utilize o [cmdlet De Antimalware Configurar De Configuração DePromalware Get-AzureServiceAntimalware](/powershell/module/servicemanagement/azure.service/get-azureserviceantimalwareconfig) Para obter a configuração antimalware.

### <a name="remove-antimalware-configuration-using-powershell-cmdlets"></a>Remover configuração antimalware usando cmdlets PowerShell

Uma aplicação ou serviço Azure pode remover a configuração antimalware e qualquer configuração de monitorização antimalware associada das extensões de serviço de antimalware e diagnóstico relevantes associadas ao Serviço de Cloud ou Máquina Virtual.

Para remover o Microsoft Antimalware utilizando cmdlets PowerShell:

1. Configurar o seu ambiente PowerShell - Consulte a documentação em <https://github.com/Azure/azure-powershell>
2. **Para máquinas virtuais**: Utilize o [cmdlet antimalware removido-AzureVMMicrosoftAntimalwareExtension Antimalware](/powershell/module/servicemanagement/azure.service/remove-azurevmmicrosoftantimalwareextension).
3. **Para serviços em nuvem:** Utilize o [cmdlet antimalware removido-AzureServiceAntimalwareExtension](/powershell/module/servicemanagement/azure.service/remove-azureserviceantimalwareextension).

Para **permitir a** recolha de eventos antimalware para uma máquina virtual utilizando o Portal de Pré-visualização Azure:

1. Clique em qualquer parte da lente de monitorização na lâmina da máquina virtual
2. Clique no comando de Diagnóstico na lâmina métrica
3. Selecione **Status** ON e verifique a opção para o sistema de eventos Windows
4. . Pode optar por desmarcar todas as outras opções da lista ou deixá-las ativadas de acordo com as necessidades do seu serviço de aplicação.
5. As categorias de eventos antimalware "Error", "Warning", "Informational", etc., são capturadas na sua conta de Armazenamento Azure.

Os eventos antimalware são recolhidos dos registos do sistema de eventos Windows para a sua conta de Armazenamento Azure. Pode configurar a Conta de Armazenamento da sua Máquina Virtual para recolher eventos de Antimalware selecionando a conta de armazenamento apropriada.

![Métricas e diagnóstico](./media/antimalware/sec-azantimal-fig8.PNG)

> [!NOTE]
> Para obter mais informações sobre como diagnosticar o registo de antimalware Azure, leia [Habilitando o registo de diagnósticos para antimalware Azure](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/).

### <a name="enable-and-configure-antimalware-monitoring-using-powershell-cmdlets"></a>Ativar e configurar a monitorização antimalware utilizando cmdlets powerShell

Pode ativar a recolha de eventos de Antimalware da Microsoft para o seu Serviço de Cloud ou Máquina Virtual utilizando o Azure Diagnostics através de cmdlets Antimalware PowerShell. A extensão Azure Diagnostics pode ser configurada para capturar eventos da fonte de registo de eventos do Sistema "Microsoft Antimalware" para a sua conta de Armazenamento Azure. As categorias de eventos antimalware "Error", "Warning", "Informational", etc., são capturadas na sua conta de Armazenamento Azure.

Para ativar a recolha de eventos antimalware na sua conta de Armazenamento Azure utilizando cmdlets PowerShell:

1. Configurar o seu ambiente PowerShell - Consulte <https://github.com/Azure/azure-powershell>
2. **Para máquinas virtuais** - Utilize o [Set-AzureVMMicrosoftAntimalwareExtension Antimalware cmdlet](/powershell/module/servicemanagement/azure.service/set-azurevmmicrosoftantimalwareextension) com a opção Monitor ON.
3. **Para serviços em nuvem** - Utilize o [cmdlet Antimalware antimalware de configuração do Set-AzureServiceAntimalware](/powershell/module/servicemanagement/azure.service/set-azureserviceantimalwareextension) com a opção Monitor ON.

Pode ver os eventos em bruto da Antimalware olhando para a tabela *WADWindowsEventLogsTable* na sua conta de Armazenamento Azure que configura para ativar a monitorização de Antimalware. Isto pode ser útil para validar que a coleção de eventos antimalware está funcionando, incluindo obter informações sobre a saúde do serviço antimalware. Para obter mais informações, incluindo o código de amostra sobre como extrair eventos antimalware da sua conta de armazenamento, consulte [o Microsoft Antimalware For Azure - Code Samples](https://aka.ms/amazsamples "Microsoft Antimalware For Azure - Amostras de código").
