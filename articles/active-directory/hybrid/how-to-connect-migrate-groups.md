---
title: 'Azure AD Connect: Grupos migrados de uma floresta para outra Microsoft Docs'
description: Este artigo descreve os passos necessários para migrar com sucesso grupos de uma floresta para outra para azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: reference
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 298cfa58d008fbeb0d58cdcff61b27fa1819ee1d
ms.sourcegitcommit: bc738d2986f9d9601921baf9dded778853489b16
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 04/02/2020
ms.locfileid: "80620834"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Migrar grupos de uma floresta para outra para Azure AD Connect

Este artigo descreve os passos necessários para migrar com sucesso grupos de uma floresta para outra para que os objetos de grupo migrados correspondam aos objetos existentes na nuvem.

## <a name="prerequisites"></a>Pré-requisitos

- Azure AD Connect versão 1.5.18.0 ou superior
- Atributo de âncora de origem é`mS-DS-ConsistencyGuid`

A partir da versão 1.5.18.0, o Azure AD `mS-DS-ConsistencyGuid` Connect começou a apoiar a utilização de grupos. Se `mS-DS-ConsistencyGuid` for escolhido como atributo de âncora de origem e o valor for povoado em AD, o Azure AD Connect utiliza o valor de `mS-DS-ConsistencyGuid` como imutável Id. Caso contrário, volta a `objectGUID`usar. No entanto, por favor note que o Azure `mS-DS-ConsistencyGuid` AD Connect **NÃO** reescreve o valor para o atributo em AD.

Durante um cenário de movimento transversal onde um objeto de grupo se move de uma floresta (digamos F1) para outra floresta (digamos F2), teremos de copiar sobre o `mS-DS-ConsistencyGuid` valor (Se PRESENTE) ou `objectGUID` o valor do objeto na floresta F1 para o `mS-DS-ConsistencyGuid` atributo do objeto em F2. 

Por favor, use os seguintes scripts como orientação para ver como pode migrar um único grupo da floresta F1 para a floresta F2. Por favor, sinta-se livre para usar isso como uma orientação para fazer a migração para vários grupos.

Primeiro, temos `objectGUID` o `mS-DS-ConsistencyGuid` e do objeto de grupo na floresta F1. Estes atributos são exportados para um ficheiro CSV.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to Export-Group script
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Em seguida, usamos o ficheiro CSV `mS-DS-ConsistencyGuid` de saída gerado para carimbar o atributo no objeto alvo na floresta F2.


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by Import-Group script
It copies either the objectGUID or mS-DS-ConsistencyGuid value from CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = [GUID] $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Passos seguintes
Saiba mais sobre como [Integrar as identidades no local ao Azure Active Directory](whatis-hybrid-identity.md).
