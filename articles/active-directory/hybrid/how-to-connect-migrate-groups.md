---
title: 'Azure AD Connect: Grupos migram de uma floresta para outra'
description: Este artigo descreve os passos necessários para migrar com sucesso grupos de uma floresta para outra para Azure AD Connect.
services: active-directory
author: billmath
manager: daveba
ms.service: active-directory
ms.topic: how-to
ms.workload: identity
ms.date: 04/02/2020
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: 5ef693a48dc52854e4e1fd8359ef24f65ce236f7
ms.sourcegitcommit: 772eb9c6684dd4864e0ba507945a83e48b8c16f0
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/19/2021
ms.locfileid: "85358587"
---
# <a name="migrate-groups-from-one-forest-to-another-for-azure-ad-connect"></a>Grupos migram de uma floresta para outra para Azure AD Connect

Este artigo descreve como migrar grupos de uma floresta para outra para que os objetos de grupo migrados correspondam aos objetos existentes na nuvem.

## <a name="prerequisites"></a>Pré-requisitos

- Azure AD Connect versão 1.5.18.0 ou mais tarde
- Atributo de âncora de origem definido para `mS-DS-ConsistencyGuid`

## <a name="migrate-groups"></a>Grupos migratórios

A partir da versão 1.5.18.0, o Azure AD Connect suporta a utilização do `mS-DS-ConsistencyGuid` atributo para grupos. Se escolher `mS-DS-ConsistencyGuid` como atributo âncora de origem e o valor for povoado no Ative Directory, o Azure AD Connect utiliza o valor de como `mS-DS-ConsistencyGuid` `immutableId` . Caso contrário, volta a ser `objectGUID` utilizado. Mas note que a Azure AD Connect não escreve o valor de volta ao `mS-DS-ConsistencyGuid` atributo no Ative Directory.

Durante um movimento transversal, quando um objeto de grupo está a mover-se de uma floresta (digamos F1) para outra floresta (digamos F2), você precisa copiar o `mS-DS-ConsistencyGuid` valor (se está presente) ou o `objectGUID` valor do objeto na floresta F1 para o `mS-DS-ConsistencyGuid` atributo do objeto em F2.

Use os seguintes scripts como um guia para aprender a migrar um único grupo de uma floresta para outra. Também pode usar estes scripts como guia para a migração de vários grupos. Os scripts usam o nome da floresta F1 para a floresta de origem e F2 para a floresta de destino.

Primeiro, temos o `objectGUID` objeto de grupo na floresta `mS-DS-ConsistencyGuid` F1. Estes atributos são exportados para um ficheiro CSV.
```
<#
DESCRIPTION
============
This script will take DN of a group as input.
It then copies the objectGUID and mS-DS-ConsistencyGuid values along with other attributes of the given group to a CSV file.

This CSV file can then be used as input to the Export-Group script.
#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $outputCsv
)

$defaultProperties = @('samAccountName', 'distinguishedName', 'objectGUID', 'mS-DS-ConsistencyGuid')
$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -Properties $defaultProperties -ErrorAction Stop
$results = @()
if ($group -eq $null)
{
       Write-Error "Group not found"
}
else
{
       $objectGUIDValue = [GUID]$group.'objectGUID'
       $mSDSConsistencyGuidValue = "N/A"
       if ($group.'mS-DS-ConsistencyGuid' -ne $null)
       {
              $mSDSConsistencyGuidValue = [GUID]$group.'mS-DS-ConsistencyGuid'
       }
       $adgroup = New-Object -TypeName PSObject
       $adgroup | Add-Member -MemberType NoteProperty -Name samAccountName -Value $($group.'samAccountName')
       $adgroup | Add-Member -MemberType NoteProperty -Name distinguishedName -Value $($group.'distinguishedName')
       $adgroup | Add-Member -MemberType NoteProperty -Name objectGUID -Value $($objectGUIDValue)
       $adgroup | Add-Member -MemberType NoteProperty -Name mS-DS-ConsistencyGuid -Value $($mSDSConsistencyGuidValue)
       $results += $adgroup
}

Write-Host "Exporting group to output file"
$results | Export-Csv "$outputCsv" -NoTypeInformation

```

Em seguida, usamos o ficheiro CSV de saída gerada para carimbar `mS-DS-ConsistencyGuid` o atributo no objeto-alvo na floresta F2:


```
<#
DESCRIPTION
============
This script will take DN of a group as input and the CSV file that was generated by the Import-Group script.
It copies either the objectGUID or the mS-DS-ConsistencyGuid value from the CSV file to the given object.

#>
Param(
       [ValidateNotNullOrEmpty()]
       [string]
       $dn,

       [ValidateNotNullOrEmpty()]
       [string]
       $inputCsv
)

$group  = Get-ADGroup -Filter "DistinguishedName -eq '$dn'" -ErrorAction Stop
if ($group -eq $null)
{
       Write-Error "Group not found"
}

$csvFile = Import-Csv -Path $inputCsv -ErrorAction Stop
$msDSConsistencyGuid = $csvFile.'mS-DS-ConsistencyGuid'
$objectGuid = [GUID] $csvFile.'objectGUID'
$targetGuid = $msDSConsistencyGuid

if ($msDSConsistencyGuid -eq "N/A")
{
       $targetGuid = $objectGuid
}

Set-ADGroup -Identity $dn -Replace @{'mS-DS-ConsistencyGuid'=$targetGuid} -ErrorAction Stop

```

## <a name="next-steps"></a>Passos seguintes
Saiba mais sobre [a integração das suas identidades no local com o Azure Ative Directory](whatis-hybrid-identity.md).
