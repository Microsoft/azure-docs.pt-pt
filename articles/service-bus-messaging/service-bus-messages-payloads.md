---
title: Mensagens de ônibus de serviço Azure, cargas e serialização Microsoft Docs
description: Este artigo fornece uma visão geral das mensagens de ônibus de serviço azure, cargas, encaminhamento de mensagens e serialização.
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2020
ms.author: aschhab
ms.openlocfilehash: 11e56ae2483a254fb00e3593da7841f3f3d844f3
ms.sourcegitcommit: 2ec4b3d0bad7dc0071400c2a2264399e4fe34897
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/27/2020
ms.locfileid: "76759402"
---
# <a name="messages-payloads-and-serialization"></a>Mensagens, payloads e serialização

O Microsoft Azure Service Bus lida com mensagens. As mensagens transportam uma carga útil, bem como metadados, sob a forma de propriedades de par de valor-chave, descrevendo a carga útil e dando instruções de manuseamento ao Service Bus e aplicações. Ocasionalmente, esses metadados por si só são suficientes para transportar a informação que o remetente quer comunicar aos recetores, e a carga útil permanece vazia.

O modelo de objeto dos clientes oficiais da Service Bus para .NET e Java reflete a estrutura abstrata de mensagens Service Bus, que está mapeada de e para os protocolos de arame suportes Service Bus.
 
Uma mensagem de ônibus de serviço consiste numa secção de carga útil binária que o Service Bus nunca lida de forma alguma no lado do serviço, e dois conjuntos de propriedades. As propriedades do *corretor* são predefinidas pelo sistema. Estas propriedades predefinidas controlam a funcionalidade de nível de mensagem dentro do corretor, ou mapeiam para itens de metadados comuns e padronizados. As propriedades do *utilizador* são uma coleção de pares de valor-chave que podem ser definidos e definidos pela aplicação.
 
As propriedades de corretor predefinidos estão listadas na tabela seguinte. Os nomes são usados com todas as APIs do cliente oficial e também no objeto [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) JSON do mapeamento do protocolo HTTP.
 
Os nomes equivalentes utilizados no nível do protocolo AMQP estão listados em parênteses. 

| Nome da Propriedade                         | Descrição                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [Tipo](/dotnet/api/microsoft.azure.servicebus.message.contenttype) de conteúdo (tipo de conteúdo)           | Opcionalmente descreve a carga útil da mensagem, com um descritor seguindo o formato de RFC2045, Secção 5; por exemplo, `application/json`.                                                                                                                                                                                                                                                                                             |
|  [Correlação (correlation-id)](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId)       | Permite que um pedido especifique um contexto para a mensagem para efeitos de correlação; por exemplo, refletindo o **MessageId** de uma mensagem que está a ser respondida.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Apenas definidos em mensagens que foram escritas com letras mortas e posteriormente reencaminhadas automaticamente da fila da letra morta para outra entidade. Indica a entidade em que a mensagem foi escrita com letras mortas. Esta propriedade é apenas leitura.                                                                                                                                                                                                                                  |
| [Contagem de entregas](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Número de entregas que foram tentadas para esta mensagem. A contagem é incrementada quando um bloqueio de mensagem expira, ou a mensagem é explicitamente abandonada pelo recetor. Esta propriedade é apenas leitura.                                                                                                                                                                                                                                                  |
| [Número enqueuedSequence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Para mensagens que foram reencaminhadas automaticamente, esta propriedade reflete o número de sequência que tinha sido atribuído pela primeira vez à mensagem no seu ponto original de submissão. Esta propriedade é apenas leitura.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | O instante UTC em que a mensagem foi aceite e armazenada na entidade. Este valor pode ser utilizado como um indicador de hora de chegada autoritário e neutro quando o recetor não quer confiar no relógio do remetente. Esta propriedade é apenas leitura.                                                                                                                                                                                                   |
|  [ExpiraatUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (tempo de caducidade absoluta) | O instante UTC em que a mensagem é marcada para remoção e já não está disponível para recuperação da entidade devido à sua expiração. A expiração é controlada pela propriedade **TimeToLive** e esta propriedade é calculada a partir de EnqueuedTimeUtc+TimeToLive. Esta propriedade é apenas leitura.                                                                                                                                                                           |
| [Persistência da Força](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | Para filas ou tópicos que tenham o conjunto de bandeiras [EnableExpress,](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) esta propriedade pode ser definida para indicar que a mensagem deve ser perspercada para o disco antes de ser reconhecida. Este é o comportamento padrão para todas as entidades não expressas.                                                                                                                                                                                                         |
| [Etiqueta](/dotnet/api/microsoft.azure.servicebus.message.label) (sujeito)                       | Esta propriedade permite que a aplicação indique o propósito da mensagem ao recetor de forma padronizada, semelhante a uma linha de assunto de e-mail.                                                                                                                                                                                                                                                                                  |
| [LockUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Para mensagens recuperadas sob um bloqueio (modo de receção de bloqueio de peek, não pré-liquidada) esta propriedade reflete o instante UTC até que a mensagem é mantida bloqueada na fila/subscrição. Quando o bloqueio expirar, o [Número de Entregas](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) é incrementado e a mensagem está novamente disponível para recuperação. Esta propriedade é apenas leitura.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | O símbolo de bloqueio é uma referência ao bloqueio que está a ser guardado pelo corretor no modo de receção *peek-lock.* O símbolo pode ser usado para fixar o cadeado permanentemente através da API [diferimento](message-deferral.md) e, com isso, tirar a mensagem do fluxo regular do estado de entrega. Esta propriedade é apenas leitura.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (message-id)                | O identificador de mensagens é um valor definido pela aplicação que identifica exclusivamente a mensagem e a sua carga útil. O identificador é uma cadeia de forma livre e pode refletir um GUID ou um identificador derivado do contexto de aplicação. Se ativada, a função de [deteção duplicada](duplicate-detection.md) identifica e remove segundae posterior submissões de mensagens com o mesmo **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | Para [entidades divididas,](service-bus-partitioning.md)a definição deste valor permite atribuir mensagens relacionadas à mesma partilha interna, de modo a que a ordem de sequência de submissão seja corretamente registada. A partição é escolhida por uma função hash sobre este valor e não pode ser escolhida diretamente. Para entidades conscientes da sessão, o imóvel **SessionId** sobrepõe-se a este valor.                                                                                                       |
| [RespostaTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (resposta a)                    | Este valor opcional e definido pela aplicação é uma forma padrão de expressar um caminho de resposta ao recetor da mensagem. Quando um remetente espera uma resposta, define o valor para o caminho absoluto ou relativo da fila ou tópico que espera que a resposta seja enviada.                                                                                                                                           |
| [AnswerToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (resposta-a-grupo-id)  | Este valor aumenta as informações **do AnswerTo** e especifica qual o **SessionId** a definir para a resposta quando enviado à entidade de resposta.                                                                                                                                                                                                                                                                            |
| [AgendadoEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Para mensagens que só são disponibilizadas para recuperação após um atraso, esta propriedade define o instante UTC no qual a mensagem será logicamente enquecida, sequenciada e, portanto, disponibilizada para recuperação.                                                                                                                                                                                                                 |
| [Número de sequência](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | O número de sequência é um inteiro único de 64 bits atribuído a uma mensagem, uma vez que é aceite e armazenado pelo corretor e funciona como o seu verdadeiro identificador. Para entidades divididas, os 16 bits mais altos refletem o identificador de partição. Os números de sequência aumentam monotonicamente e são ingapáveis. Rolam para 0 quando o intervalo de 48-64 bits está esgotado. Esta propriedade é apenas leitura.                                                                |
| [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (group-id)                  | Para entidades conscientes da sessão, este valor definido pela aplicação especifica a afiliação da sessão da mensagem. As mensagens com o identificador da mesma sessão estão sujeitas a bloqueio sumário e permitem o processamento e desminagem exatos em ordem. Para entidades que não estão conscientes da sessão, este valor é ignorado.                                                                                                                                     |
| [Tamanho](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Reflete o tamanho armazenado da mensagem no registo do corretor como uma contagem de bytes, uma vez que conta para a quota de armazenamento. Esta propriedade é apenas leitura.                                                                                                                                                                                                                                                                                                       |
| [Estado](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Indica o estado da mensagem no registo. Esta propriedade só é relevante durante a navegação por mensagens ("espreitar"), para determinar se uma mensagem está "ativa" e disponível para recuperação à medida que chega ao topo da fila, quer seja adiada ou à espera de ser agendada. Esta propriedade é apenas leitura.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Este valor é a duração relativa após a qual a mensagem expira, a partir do instante em que a mensagem foi aceite e armazenada pelo corretor, conforme capturado em **EnqueueTimeUtc**. Quando não definido explicitamente, o valor assumido é o **DefaultTimeToLive** para a respetiva fila ou tópico. Um valor **timeToLive** ao nível da mensagem não pode ser mais longo do que a definição **PadrãoTimeToLive** da entidade. Se for mais comprido, é silenciosamente ajustado. |
| [Para](/dotnet/api/microsoft.azure.servicebus.message.to) (para)                               | Esta propriedade é reservada para uso futuro em cenários de encaminhamento e atualmente ignorada pelo próprio corretor. As aplicações podem utilizar este valor em cenários de acorrentação automática orientados por regras para indicar o destino lógico pretendido da mensagem.                                                                                                                                                                                   |
| [ViapartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Se uma mensagem for enviada através de uma fila de transferências no âmbito de uma transação, este valor seleciona a divisória da fila de transferências.                                                                                                                                                                                                                                                                                                                 |

O modelo de mensagem abstrata permite que uma mensagem seja postada numa fila via HTTP (na verdade sempre HTTPS) e pode ser recuperada via AMQP. Em qualquer dos casos, a mensagem parece normal no contexto do respetivo protocolo. As propriedades do corretor são traduzidas conforme necessário, e as propriedades do utilizador são mapeadas para a localização mais apropriada no respetivo modelo de mensagem protocolar. Em HTTP, as propriedades do utilizador mapeiam diretamente de e para cabeçalhos HTTP; na AMQP mapeiam de e para o mapa de **propriedades de aplicação.**

## <a name="message-routing-and-correlation"></a>Encaminhamento de mensagens e correlação

Um subconjunto das propriedades de corretor descritoanteriormente, especificamente [Para](/dotnet/api/microsoft.azure.servicebus.message.to), [AnswerTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [AnswerToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid), e [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), são usados para ajudar as aplicações a enviar mensagens para determinados destinos. Para ilustrar isto, considere alguns padrões:

- **Simples pedido/resposta**: Um editor envia uma mensagem para uma fila e espera uma resposta do consumidor de mensagens. Para receber a resposta, a editora possui uma fila na qual espera que as respostas sejam entregues. O endereço dessa fila é expresso na propriedade **AnswerTo** da mensagem de saída. Quando o consumidor responde, copia o **MessageId** da mensagem manipulada para a propriedade **CorrelationId** da mensagem de resposta e entrega a mensagem ao destino indicado pela propriedade **AnswerTo.** Uma mensagem pode dar respostas múltiplas, dependendo do contexto de aplicação.
- **Pedido/resposta multicast**: Como variação do padrão anterior, uma editora envia a mensagem para um tópico e vários assinantes tornam-se elegíveis para consumir a mensagem. Cada um dos subscritores pode responder da forma descrita anteriormente. Este padrão é usado em cenários de descoberta ou roll-call e o respondente normalmente identifica-se com uma propriedade do utilizador ou dentro da carga útil. Se **o AnswerTo** apontar para um tópico, tal conjunto de respostas de descoberta pode ser distribuído para um público.
- **Multiplexing**: Esta função de sessão permite o multiplexing de fluxos de mensagens relacionadas através de uma única fila ou subscrição de modo que cada sessão (ou grupo) de mensagens relacionadas, identificadas por valores **SessionId** correspondentes, sejam encaminhadas para um recetor específico enquanto o recetor mantém a sessão bloqueada. Leia mais sobre os detalhes das sessões [aqui.](message-sessions.md)
- **Pedido/resposta multiplexed**: Esta funcionalidade de sessão permite respostas multiplexed, permitindo que vários editores partilhem uma fila de respostas. Ao definir **o AnswerToSessionId,** o editor pode instruir o(s) consumidor(s) a copiar esse valor na propriedade **SessionId** da mensagem de resposta. A fila de publicação ou o tópico não precisa de estar atento à sessão. À medida que a mensagem é enviada, a editora pode então esperar especificamente por uma sessão com o dado **SessionId** para se materializar na fila aceitando condicionalmente um recetor de sessão. 

O encaminhamento dentro de um espaço de nome de ônibus de serviço pode ser realizado usando regras de subscrição de correntes automáticas e tópicos. O encaminhamento através de espaços de nomes pode ser realizado [usando Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Como indicado na lista anterior, o imóvel **To** é reservado para uso futuro e pode eventualmente ser interpretado pelo corretor com uma funcionalidade especialmente ativada. As aplicações que desejem implementar o encaminhamento devem fazê-lo com base nas propriedades dos utilizadores e não se apoiar na propriedade **To;** no entanto, fazê-lo agora não causará problemas de compatibilidade.

## <a name="payload-serialization"></a>Serialização da carga útil

Quando em trânsito ou armazenada dentro do Service Bus, a carga útil é sempre um bloco opaco e binário. A propriedade [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) permite que as aplicações descrevam a carga útil, sendo o formato sugerido para os valores da propriedade uma descrição do tipo de conteúdo MIME de acordo com o IETF RFC2045; por exemplo, `application/json;charset=utf-8`.

Ao contrário das variantes Java ou .NET Standard, a versão .NET Framework da API do Bus de Serviço suporta a criação de instâncias **BrokeredMessage,** passando objetos arbitrários .NET para o construtor. 

Ao utilizar o protocolo SBMP legado, esses objetos são então serializados com o serializador binário predefinido, ou com um serializador fornecido externamente. Ao utilizar o protocolo AMQP, o objeto é serializado num objeto AMQP. O recetor pode recuperar esses objetos com o método [GetBody\<T>() ()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) fornecendo o tipo esperado. Com amqp, os objetos são serializados em um gráfico AMQP de **ArrayList** e **IDictionary<cordas, objeto>** objetos, e qualquer cliente AMQP pode descodificá-los. 

Embora esta magia de serialização escondida seja conveniente, as aplicações devem assumir o controlo explícito da serialização do objeto e transformar os seus gráficos de objetos em fluxos antes de incluí-los numa mensagem, e fazer o inverso no lado recetor. Isto produz resultados interoperáveis. Note-se também que, embora a AMQP tenha um poderoso modelo binário de codificação, está ligada ao ecossistema de mensagens AMQP e os clientes http terão dificuldade em descodificar tais cargas. 

Geralmente recomendamos jSON e Apache Avro como formatos de carga útil para dados estruturados.

As variantes .NET Standard e Java API só aceitam matrizes byte, o que significa que a aplicação deve lidar com o controlo de serialização de objetos. 

## <a name="next-steps"></a>Passos seguintes

Para saber mais sobre as mensagens de ônibus de serviço, consulte os seguintes tópicos:

* [Filas, tópicos e subscrições do Service Bus](service-bus-queues-topics-subscriptions.md)
* [Começar com as filas de ônibus de serviço](service-bus-dotnet-get-started-with-queues.md)
* [Como utilizar os tópicos e as subscrições do Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
