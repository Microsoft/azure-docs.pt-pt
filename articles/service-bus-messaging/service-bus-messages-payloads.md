---
title: Mensagens de autocarro da Azure Service, cargas e serialização Microsoft Docs
description: Este artigo fornece uma visão geral das mensagens do Azure Service Bus, cargas, encaminhamento de mensagens e serialização.
ms.topic: article
ms.date: 06/23/2020
ms.openlocfilehash: d426489776dff652cbf72d640f3e74b1bc8e30d4
ms.sourcegitcommit: 829d951d5c90442a38012daaf77e86046018e5b9
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 10/09/2020
ms.locfileid: "85341686"
---
# <a name="messages-payloads-and-serialization"></a>Mensagens, payloads e serialização

O Microsoft Azure Service Bus trata as mensagens. As mensagens transportam uma carga útil, bem como metadados, sob a forma de propriedades de pares de valor-chave, descrevendo a carga útil e dando instruções de manuseamento ao Service Bus e aplicações. Ocasionalmente, esses metadados por si só são suficientes para transportar a informação que o remetente quer comunicar aos recetores, e a carga útil permanece vazia.

O modelo de objeto dos clientes oficiais do Service Bus para .NET e Java refletem a estrutura abstrata da mensagem do Service Bus, que está mapeada de e para os protocolos de fio suportes service bus.
 
Uma mensagem de Bus de Serviço consiste numa secção binária de carga útil que o Service Bus nunca trata de qualquer forma no lado do serviço e dois conjuntos de propriedades. As *propriedades do corretor* são predefinidas pelo sistema. Estas propriedades predefinidas controlam a funcionalidade do nível de mensagens dentro do corretor, ou mapeiam para itens de metadados comuns e padronizados. As *propriedades do utilizador* são uma coleção de pares de valor-chave que podem ser definidos e definidos pela aplicação.
 
As propriedades do corretor predefinido estão listadas na tabela seguinte. Os nomes são utilizados com todas as APIs oficiais do cliente e também no objeto JSON da [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) do mapeamento do protocolo HTTP.
 
Os nomes equivalentes utilizados ao nível do protocolo AMQP estão listados em parênteses. 

| Nome da Propriedade                         | Descrição                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [Tipo de conteúdo](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (tipo de conteúdo)           | Opcionalmente descreve a carga útil da mensagem, com um descritor seguindo o formato de RFC2045, Secção 5; por exemplo, `application/json` . .                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (correlação-id)       | Permite que uma aplicação especifique um contexto para a mensagem para efeitos de correlação; por exemplo, refletindo o **MessageId** de uma mensagem que está a ser respondido.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Apenas definido em mensagens que foram enviadas com letra morta e posteriormente enviadas automaticamente da fila de cartas mortas para outra entidade. Indica a entidade na qual a mensagem foi enviada. Esta propriedade é só para leitura.                                                                                                                                                                                                                                  |
| [Entrega](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Número de entregas que foram tentadas para esta mensagem. A contagem é incrementada quando um bloqueio de mensagem expira, ou a mensagem é explicitamente abandonada pelo recetor. Esta propriedade é só para leitura.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Para mensagens que foram reencaminhadas automaticamente, esta propriedade reflete o número de sequência que tinha sido inicialmente atribuído à mensagem no seu ponto original de submissão. Esta propriedade é só para leitura.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | O instantâneo UTC no qual a mensagem foi aceite e armazenada na entidade. Este valor pode ser utilizado como indicador de hora de chegada autoritária e neutra quando o recetor não pretende confiar no relógio do remetente. Esta propriedade é só para leitura.                                                                                                                                                                                                   |
|  [ExpiraAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (prazo de validade absoluto) | O instantâneo UTC em que a mensagem está marcada para remoção e já não está disponível para recuperação da entidade devido à sua expiração. A expiração é controlada pela propriedade **TimeToLive** e esta propriedade é calculada a partir de EnqueuedTimeUtc+TimeToLive. Esta propriedade é só para leitura.                                                                                                                                                                           |
| [ForçaPersistência](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | Para filas ou tópicos que tenham o conjunto de bandeira [EnableExpress,](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) esta propriedade pode ser configurada para indicar que a mensagem deve ser persistido no disco antes de ser reconhecida. Este é o comportamento padrão para todas as entidades não expressas.                                                                                                                                                                                                         |
| [Etiqueta](/dotnet/api/microsoft.azure.servicebus.message.label) (assunto)                       | Esta propriedade permite que a aplicação indique o propósito da mensagem para o recetor de forma padronizada, semelhante a uma linha de e-mail sujeito.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Para mensagens recuperadas sob uma fechadura (modo de receção de bloqueio e não pré-liquidado) esta propriedade reflete o instante UTC até ao qual a mensagem é mantida bloqueada na fila/subscrição. Quando o bloqueio expira, o [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) é incrementado e a mensagem está novamente disponível para recuperação. Esta propriedade é só para leitura.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | O token de bloqueio é uma referência à fechadura que está a ser mantida pelo corretor no modo de receção *de bloqueio.* O token pode ser usado para fixar a fechadura permanentemente através da API [diferral](message-deferral.md) e, com isso, tirar a mensagem do fluxo regular do estado de entrega. Esta propriedade é só para leitura.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (id de mensagem)                | O identificador de mensagens é um valor definido pela aplicação que identifica exclusivamente a mensagem e a sua carga útil. O identificador é uma cadeia de forma livre e pode refletir um GUID ou um identificador derivado do contexto da aplicação. Se ativado, a [função de deteção duplicada](duplicate-detection.md) identifica e remove a segunda e mais submissões de mensagens com o mesmo **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | Para [as entidades divididas,](service-bus-partitioning.md)a definição deste valor permite atribuir mensagens relacionadas à mesma partição interna, de modo a que a ordem de sequência de submissão seja corretamente registada. A partição é escolhida por uma função de haxixe sobre este valor e não pode ser escolhida diretamente. Para entidades conscientes da sessão, a propriedade **SessionId** sobrepõe-se a este valor.                                                                                                       |
| [RespostaTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (resposta a)                    | Este valor opcional e definido pela aplicação é uma forma padrão de expressar um caminho de resposta ao recetor da mensagem. Quando um remetente espera uma resposta, define o valor para o caminho absoluto ou relativo da fila ou tópico a que espera que a resposta seja enviada.                                                                                                                                           |
| [AnswerToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (resposta-id grupo)  | Este valor aumenta a informação **AnswerTo** e especifica quais o **SessionId** que deve ser definido para a resposta quando enviado à entidade de resposta.                                                                                                                                                                                                                                                                            |
| [ProgramadoEnqueueTimeutc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Para mensagens que só são disponibilizadas para recuperação após um atraso, esta propriedade define o instante UTC no qual a mensagem será logicamente encostado, sequenciado e, portanto, disponibilizado para recuperação.                                                                                                                                                                                                                 |
| [SequênciaNumer](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | O número de sequência é um número inteiro único de 64 bits atribuído a uma mensagem, uma vez que é aceite e armazenado pelo corretor e funciona como o seu verdadeiro identificador. Para entidades divididas, os 16 bits mais altos refletem o identificador de partição. Os números de sequência aumentam monotonicamente e não têm lacunas. Eles rebolam para 0 quando o intervalo de 48-64 bits está esgotado. Esta propriedade é só para leitura.                                                                |
| [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (id de grupo)                  | Para entidades conscientes da sessão, este valor definido pela aplicação especifica a afiliação da sessão da mensagem. As mensagens com o mesmo identificador de sessão estão sujeitas a bloqueio sumário e permitem o processamento e demultiplexo exatos. Para entidades que não têm conhecimento da sessão, este valor é ignorado.                                                                                                                                     |
| [Tamanho](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Reflete o tamanho armazenado da mensagem no registo do corretor como uma contagem de bytes, uma vez que conta para a quota de armazenamento. Esta propriedade é só para leitura.                                                                                                                                                                                                                                                                                                       |
| [Estado](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Indica o estado da mensagem no registo. Esta propriedade só é relevante durante a navegação por mensagem ("espreitar"), para determinar se uma mensagem está "ativa" e disponível para recuperação à medida que chega ao topo da fila, se é adiada ou está à espera de ser agendada. Esta propriedade é só para leitura.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Este valor é a duração relativa após a qual a mensagem expira, a partir do instante em que a mensagem foi aceite e armazenada pelo corretor, tal como capturado no **EnqueueTimeUtc**. Quando não definido explicitamente, o valor assumido é o **DefaultTimeToLive** para a respetiva fila ou tópico. Um valor **TimeToLive** ao nível de mensagem não pode ser mais longo do que a definição **DefaultTimeToLive** da entidade. Se for mais comprido, é ajustado silenciosamente. |
| [Para](/dotnet/api/microsoft.azure.servicebus.message.to) (para)                               | Esta propriedade é reservada para uso futuro em cenários de encaminhamento e atualmente ignorada pelo próprio corretor. As aplicações podem usar este valor em cenários de acorrentamento autoavançados orientados por regras para indicar o destino lógico pretendido da mensagem.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Se uma mensagem for enviada através de uma fila de transferência no âmbito de uma transação, este valor seleciona a divisão da fila de transferência.                                                                                                                                                                                                                                                                                                                 |

O modelo de mensagem abstrata permite que uma mensagem seja publicada numa fila via HTTP (na verdade sempre HTTPS) e pode ser recuperada através de AMQP. Em qualquer dos casos, a mensagem parece normal no contexto do respetivo protocolo. As propriedades do corretor são traduzidas conforme necessário, e as propriedades do utilizador são mapeadas para a localização mais apropriada no respetivo modelo de mensagem de protocolo. Em HTTP, as propriedades dos utilizadores mapeiam diretamente de e para os cabeçalhos HTTP; em AMQP eles mapeiam de e para o mapa **de propriedades de aplicação.**

## <a name="message-routing-and-correlation"></a>Encaminhamento de mensagens e correlação

Um subconjunto das propriedades do corretor descrito anteriormente, especificamente [Para](/dotnet/api/microsoft.azure.servicebus.message.to), [AnswerTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [AnswerTo, AnswerTo,](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) [MessageId,](/dotnet/api/microsoft.azure.servicebus.message.messageid) [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid), e [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), são usados para ajudar as aplicações a encaminhar mensagens para determinados destinos. Para ilustrar isto, considere alguns padrões:

- **Simples pedido/resposta**: Um editor envia uma mensagem para uma fila e espera uma resposta do consumidor da mensagem. Para receber a resposta, a editora detém uma fila na qual espera que as respostas sejam entregues. O endereço dessa fila é expresso na **propriedade AnswerTo** da mensagem de saída. Quando o consumidor responde, copia o **MessageId** da mensagem tratada na propriedade **CorrelationId** da mensagem de resposta e entrega a mensagem ao destino indicado pela propriedade **AnswerTo.** Uma mensagem pode produzir várias respostas, dependendo do contexto da aplicação.
- **Pedido/resposta multicast**: Como uma variação do padrão anterior, um editor envia a mensagem para um tópico e vários assinantes tornam-se elegíveis para consumir a mensagem. Cada um dos subscritores poderá responder da forma descrita anteriormente. Este padrão é usado em cenários de descoberta ou roll-call e o respondente normalmente identifica-se com uma propriedade do utilizador ou dentro da carga útil. Se **o AnswerTo** aponta para um tópico, um conjunto de respostas de descoberta pode ser distribuído a um público.
- **Multiplexing**: Esta função de sessão permite a multiplexing de streams de mensagens relacionadas através de uma única fila ou subscrição de modo a que cada sessão (ou grupo) de mensagens relacionadas, identificadas por valores **de SessionId** correspondentes, sejam encaminhadas para um recetor específico enquanto o recetor mantém a sessão bloqueada. Leia mais sobre os detalhes das sessões [aqui.](message-sessions.md)
- **Pedido/resposta multiplexed**: Esta função de sessão permite respostas multiplexed, permitindo que vários editores partilhem uma fila de resposta. Ao definir **AnswerToSessionId,** o editor pode instruir o(s) consumidor(s) a copiar esse valor na propriedade **SessionId** da mensagem de resposta. A fila de publicação ou tópico não precisa de estar atento à sessão. À medida que a mensagem é enviada, a editora pode então aguardar especificamente uma sessão com o **SessionId** dado para se materializar na fila aceitando condicionalmente um recetor de sessão. 

O encaminhamento dentro de um espaço de nomes de Service Bus pode ser realizado usando regras de acorrenteamento autoavançada e subscrição de tópicos. O encaminhamento através de espaços de nome pode ser realizado [usando Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Como indicado na lista anterior, o imóvel **To** está reservado para uso futuro e pode eventualmente ser interpretado pelo corretor com uma funcionalidade especialmente ativada. As aplicações que desejem implementar o encaminhamento devem fazê-lo com base nas propriedades dos utilizadores e não se apoiar na propriedade **To;** no entanto, fazê-lo agora não irá causar problemas de compatibilidade.

## <a name="payload-serialization"></a>Serialização da carga útil

Quando em trânsito ou guardado dentro do Service Bus, a carga útil é sempre um bloco opaco e binário. A propriedade [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) permite que as aplicações descrevam a carga útil, sendo o formato sugerido para os valores de propriedade uma descrição do tipo de conteúdo MIME de acordo com o IETF RFC2045; por exemplo, `application/json;charset=utf-8` . .

Ao contrário das variantes Java ou .NET Standard, a versão .NET Framework da API service bus suporta a criação de instâncias **DemetredMessage** passando objetos arbitrários .NET no construtor. 

Ao utilizar o protocolo SBMP legado, esses objetos são então serializados com o serializador binário predefinido, ou com um serializador fornecido externamente. Ao utilizar o protocolo AMQP, o objeto é serializado num objeto AMQP. O recetor pode recuperar esses objetos com o método [GetBody \<T> ()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) fornecendo o tipo esperado. Com AMQP, os objetos são serializados em um gráfico AMQP de **ArrayList** e **IDictionary<cadeia, objeto>** objetos, e qualquer cliente AMQP pode descodificá-los. 

Embora esta magia de serialização escondida seja conveniente, as aplicações devem assumir o controlo explícito da serialização dos objetos e transformar os seus gráficos de objetos em fluxos antes de incluí-los numa mensagem, e fazer o inverso no lado recetor. Isto produz resultados interoperáveis. Note-se também que, embora a AMQP tenha um poderoso modelo binário de codificação, está ligada ao ecossistema de mensagens AMQP e os clientes HTTP terão dificuldade em descoditar essas cargas. 

Recomendamos geralmente json e Apache Avro como formatos de carga útil para dados estruturados.

As variantes .NET Standard e Java API apenas aceitam arrays byte, o que significa que a aplicação deve lidar com o controlo de serialização de objetos. 

## <a name="next-steps"></a>Passos seguintes

Para saber mais sobre as mensagens do Service Bus, consulte os seguintes tópicos:

* [Filas, tópicos e subscrições do Service Bus](service-bus-queues-topics-subscriptions.md)
* [Introdução às filas do Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Como utilizar os tópicos e as subscrições do Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
