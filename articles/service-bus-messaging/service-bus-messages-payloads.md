---
title: Mensagens, cargas e serialização do barramento de serviço do Azure | Microsoft Docs
description: Visão geral de cargas de mensagens do barramento de serviço
services: service-bus-messaging
documentationcenter: ''
author: axisc
manager: timlt
editor: spelluru
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/26/2018
ms.author: aschhab
ms.openlocfilehash: 26256fe968eff5f7570885278620fded5673b5a0
ms.sourcegitcommit: a6873b710ca07eb956d45596d4ec2c1d5dc57353
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 07/16/2019
ms.locfileid: "68249974"
---
# <a name="messages-payloads-and-serialization"></a>Mensagens, payloads e serialização

Barramento de Serviço do Microsoft Azure manipula mensagens. As mensagens carregam uma carga, bem como metadados, na forma de propriedades de pares chave-valor, descrevendo a carga e fornecendo instruções de tratamento para o barramento de serviço e os aplicativos. Ocasionalmente, os metadados sozinhos são suficientes para transportar as informações que o remetente deseja comunicar aos destinatários e a carga permanece vazia.

O modelo de objeto dos clientes oficiais do barramento de serviço para .NET e Java refletem a estrutura abstrata de mensagens do barramento de serviço, que é mapeada de e para os protocolos de conexão com suporte do barramento de serviço.
 
Uma mensagem do barramento de serviço consiste em uma seção de carga binária que o barramento de serviço nunca manipula em nenhum formulário no lado do serviço e dois conjuntos de propriedades. As *Propriedades do agente* são predefinidas pelo sistema. Essas propriedades predefinidas controlam a funcionalidade de nível de mensagem dentro do agente ou são mapeadas para itens de metadados comuns e padronizados. As *Propriedades do usuário* são uma coleção de pares chave-valor que podem ser definidos e definidos pelo aplicativo.
 
As propriedades de agente predefinidas são listadas na tabela a seguir. Os nomes são usados com todas as APIs de cliente oficiais e também [](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) no objeto JSON brokerproperties do mapeamento de protocolo http.
 
Os nomes equivalentes usados no nível do protocolo AMQP são listados entre parênteses. 

| Nome da propriedade                         | Descrição                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (Content-Type)           | Opcionalmente, descreve a carga da mensagem, com um descritor após o formato de RFC2045, seção 5; por exemplo, `application/json`.                                                                                                                                                                                                                                                                                             |
|  [](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) CorrelationId (ID de correlação)       | Permite que um aplicativo especifique um contexto para a mensagem para fins de correlação; por exemplo, refletir a **MessageId** de uma mensagem que está sendo respondida.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Definido somente em mensagens que tenham sido devolvidas e subsequentemente encaminhadas automaticamente da fila de mensagens mortas para outra entidade. Indica a entidade na qual a mensagem foi devolvida. Esta propriedade é somente leitura.                                                                                                                                                                                                                                  |
| [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Número de entregas que foram tentadas para esta mensagem. A contagem é incrementada quando um bloqueio de mensagem expira, ou a mensagem é explicitamente abandonada pelo destinatário. Esta propriedade é somente leitura.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Para mensagens que foram encaminhadas automaticamente, essa propriedade reflete o número de sequência que havia sido atribuído primeiro à mensagem em seu ponto original de envio. Esta propriedade é somente leitura.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | O instante de UTC em que a mensagem foi aceita e armazenada na entidade. Esse valor pode ser usado como um indicador de tempo de chegada autoritativo e neutro quando o receptor não quiser confiar no relógio do remetente. Esta propriedade é somente leitura.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolute-expiry-time) | O instante de UTC em que a mensagem é marcada para remoção e não está mais disponível para recuperação da entidade devido à expiração. A expiração é controlada pela propriedade **TimeToLive** e essa propriedade é computada de EnqueuedTimeUtc + TimeToLive. Esta propriedade é somente leitura.                                                                                                                                                                           |
| [ForcePersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | Para filas ou tópicos que têm o sinalizador [EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) definido, essa propriedade pode ser definida para indicar que a mensagem deve ser persistida no disco antes de ser confirmada. Esse é o comportamento padrão para todas as entidades não expressas.                                                                                                                                                                                                         |
| [Rótulo](/dotnet/api/microsoft.azure.servicebus.message.label) do subjetiva                       | Essa propriedade permite que o aplicativo indique a finalidade da mensagem para o receptor de maneira padronizada, semelhante a uma linha de assunto de email.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Para mensagens recuperadas em um bloqueio (modo de recebimento de bloqueio de pico, não previamente liquidado) essa propriedade reflete o instante UTC até que a mensagem seja mantida bloqueada na fila/assinatura. Quando o bloqueio expira, o [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) é incrementado e a mensagem fica novamente disponível para recuperação. Esta propriedade é somente leitura.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | O token de bloqueio é uma referência ao bloqueio que está sendo mantido pelo agente no modo de recebimento de *bloqueio de pico* . O token pode ser usado para fixar o bloqueio permanentemente por meio da API de [adiamento](message-deferral.md) e, com isso, retirar a mensagem do fluxo de estado de entrega normal. Esta propriedade é somente leitura.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (ID da mensagem)                | O identificador de mensagem é um valor definido pelo aplicativo que identifica exclusivamente a mensagem e sua carga. O identificador é uma cadeia de caracteres de forma livre e pode refletir um GUID ou um identificador derivado do contexto do aplicativo. Se habilitada, o recurso de [detecção](duplicate-detection.md) de duplicidades identifica e remove o segundo e outros envios de mensagens com a mesma **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | Para [entidades particionadas](service-bus-partitioning.md), a definição desse valor permite atribuir mensagens relacionadas à mesma partição interna, para que a ordem de sequência de envio seja registrada corretamente. A partição é escolhida por uma função de hash sobre esse valor e não pode ser escolhida diretamente. Para entidades com reconhecimento de sessão, a propriedade **SessionID** substitui esse valor.                                                                                                       |
| [Responder](/dotnet/api/microsoft.azure.servicebus.message.replyto) a (responder a)                    | Esse valor opcional e definido pelo aplicativo é uma maneira padrão de expressar um caminho de resposta para o destinatário da mensagem. Quando um remetente espera uma resposta, ele define o valor para o caminho absoluto ou relativo da fila ou do tópico ao qual ele espera que a resposta seja enviada.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (reply-to-Group-ID)  | Esse valor aumenta as informações de ReplyTo e especifica qual **SessionID** deve ser definida para a resposta quando enviada para a entidade de resposta.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Para mensagens que só são disponibilizadas para recuperação após um atraso, essa propriedade define o instante UTC no qual a mensagem será logicamente enfileirada, sequenciada e, portanto, disponibilizada para recuperação.                                                                                                                                                                                                                 |
| [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | O número de sequência é um inteiro de 64 bits exclusivo atribuído a uma mensagem conforme ele é aceito e armazenado pelo agente e pelo Functions como seu identificador verdadeiro. Para entidades particionadas, os 16 bits superiores refletem o identificador de partição. Os números de sequência aumentam de forma monotônico e são intervalo. Eles passam para 0 quando o intervalo de 48-64 bits é esgotado. Esta propriedade é somente leitura.                                                                |
| [SessionID](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (ID do grupo)                  | Para entidades com reconhecimento de sessão, esse valor definido pelo aplicativo especifica a afiliação de sessão da mensagem. As mensagens com o mesmo identificador de sessão estão sujeitas ao bloqueio de resumo e permitem o processamento e a demultiplexação exatas em ordem. Para entidades que não reconhecem a sessão, esse valor é ignorado.                                                                                                                                     |
| [Tamanho](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Reflete o tamanho armazenado da mensagem no log do agente como uma contagem de bytes, uma vez que ele conta para a cota de armazenamento. Esta propriedade é somente leitura.                                                                                                                                                                                                                                                                                                       |
| [Status](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Indica o estado da mensagem no log. Essa propriedade só é relevante durante a procura de mensagens ("Peek"), para determinar se uma mensagem está "ativa" e disponível para recuperação, já que ela atinge a parte superior da fila, se ela é adiada ou está aguardando para ser agendada. Esta propriedade é somente leitura.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Esse valor é a duração relativa após a qual a mensagem expira, a partir do instante em que a mensagem foi aceita e armazenada pelo agente, conforme capturada em **EnqueueTimeUtc**. Quando não definido explicitamente, o valor presumido é o **DefaultTimeToLive** para a respectiva fila ou tópico. Um valor **TimeToLive** de nível de mensagem não pode ser maior que a configuração **DefaultTimeToLive** da entidade. Se for mais longo, ele será ajustado silenciosamente. |
| [Para](/dotnet/api/microsoft.azure.servicebus.message.to) às                               | Essa propriedade é reservada para uso futuro em cenários de roteamento e atualmente ignorada pelo próprio agente. Os aplicativos podem usar esse valor em cenários de encadeamento de encaminhamento automático orientados por regras para indicar o destino lógico pretendido da mensagem.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Se uma mensagem for enviada por meio de uma fila de transferência no escopo de uma transação, esse valor selecionará a partição da fila de transferência.                                                                                                                                                                                                                                                                                                                 |

O modelo de mensagem abstrata permite que uma mensagem seja postada em uma fila via HTTP (na verdade, sempre HTTPS) e possa ser recuperada via AMQP. Em ambos os casos, a mensagem parece normal no contexto do respectivo protocolo. As propriedades do agente são convertidas conforme necessário, e as propriedades do usuário são mapeadas para o local mais apropriado no respectivo modelo de mensagem de protocolo. No HTTP, as propriedades do usuário são mapeadas diretamente para e de cabeçalhos HTTP; no AMQP, eles são mapeados para e do mapa de **Propriedades de aplicativo** .

## <a name="message-routing-and-correlation"></a>Roteamento e correlação de mensagens

Um subconjunto das propriedades do agente descrito anteriormente, especificamente [para](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), CorrelationId e [SessionID](/dotnet/api/microsoft.azure.servicebus.message.sessionid), são usados para ajudar os aplicativos a rotear mensagens para [](/dotnet/api/microsoft.azure.servicebus.message.correlationid) destinos específicos. Para ilustrar isso, considere alguns padrões:

- **Solicitação/resposta simples**: Um Publicador envia uma mensagem para uma fila e espera uma resposta do consumidor da mensagem. Para receber a resposta, o Publicador possui uma fila na qual ele espera que as respostas sejam entregues. O endereço dessa fila é expresso na propriedade **ReplyTo** da mensagem de saída. Quando o consumidor responde, ele copia a **MessageId** da mensagem manipulada na propriedade CorrelationId da mensagem de resposta e entrega a mensagem para o destino indicado pela propriedade **ReplyTo** . Uma mensagem pode produzir várias respostas, dependendo do contexto do aplicativo.
- **Solicitação/resposta multicast**: Como uma variação do padrão anterior, um Publicador envia a mensagem para um tópico e vários assinantes se tornam qualificados para consumir a mensagem. Cada um dos assinantes pode responder da maneira descrita anteriormente. Esse padrão é usado em cenários de descoberta ou de chamada e o pesquisador normalmente se identifica com uma propriedade de usuário ou dentro da carga. Se **ReplyTo** apontar para um tópico, tal conjunto de respostas de descoberta poderá ser distribuído a um público.
- **Multiplexação**: Esse recurso de sessão permite a multiplexação de fluxos de mensagens relacionadas por meio de uma única fila ou assinatura, de modo que cada sessão (ou grupo) de mensagens relacionadas, identificadas por valores de **SessionID** correspondentes, seja roteada para um destinatário específico enquanto o o destinatário mantém a sessão sob bloqueio. Leia mais sobre os detalhes das sessões [aqui](message-sessions.md).
- **Solicitação/resposta multiplexada**: Esse recurso de sessão permite respostas multiplexada, permitindo que vários Publicadores compartilhem uma fila de respostas. Ao definir **ReplyToSessionId**, o Publicador pode instruir os consumidores a copiar esse valor para a propriedade **SessionID** da mensagem de resposta. A fila de publicação ou o tópico não precisa ter reconhecimento de sessão. À medida que a mensagem é enviada, o Publicador pode aguardar especificamente uma sessão com a **SessionID** determinada para materializar na fila, aceitando condicionalmente um receptor de sessão. 

O roteamento dentro de um namespace do barramento de serviço pode ser percebido usando regras de assinatura de tópico e encadeamento de encaminhamento automático. O roteamento entre namespaces pode ser realizado [usando o Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Conforme indicado na lista anterior, a propriedade **to** é reservada para uso futuro e, eventualmente, pode ser interpretada pelo agente com um recurso especialmente habilitado. Os aplicativos que desejam implementar o roteamento devem fazer isso com base nas propriedades do usuário e não na propriedade **to** . no entanto, fazer isso agora não causará problemas de compatibilidade.

## <a name="payload-serialization"></a>Serialização de conteúdo

Quando estiver em trânsito ou armazenado dentro do barramento de serviço, a carga será sempre um bloco opaco e binário. A propriedade [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) permite que os aplicativos descrevam a carga, com o formato sugerido para os valores de propriedade sendo uma descrição de tipo de conteúdo MIME de acordo com a IETF rfc2045; por exemplo, `application/json;charset=utf-8`.

Ao contrário das variantes de Java ou .NET Standard, a versão .NET Framework da API do barramento de serviço dá suporte à criação de instâncias **BrokeredMessage** passando objetos .net arbitrários para o construtor. 

Ao usar o protocolo SBMP herdado, esses objetos são serializados com o serializador binário padrão ou com um serializador que é fornecido externamente. Ao usar o protocolo AMQP, o objeto é serializado em um objeto AMQP. O receptor pode recuperar esses objetos com o método [GetBody\<T > ()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) , fornecendo o tipo esperado. Com o AMQP, os objetos são serializados em um grafo AMQP de **ArrayList** e **IDictionary < cadeia de caracteres,** objetos de > de objeto e qualquer cliente AMQP pode decodificá-los. 

Embora essa mágica de serialização oculta seja conveniente, os aplicativos devem assumir o controle explícito da serialização de objetos e transformar seus grafos de objeto em fluxos antes de incluí-los em uma mensagem e fazer o inverso no lado do destinatário. Isso produz resultados interoperáveis. Também deve-se observar que, embora o AMQP tenha um poderoso modelo de codificação binária, ele está vinculado ao ecossistema de mensagens AMQP e os clientes HTTP terão problemas para decodificar tais cargas. 

Geralmente, recomendamos JSON e Apache Avro como formatos de carga para dados estruturados.

As variantes .NET Standard e API Java aceitam apenas matrizes de bytes, o que significa que o aplicativo deve manipular o controle de serialização de objeto. 

## <a name="next-steps"></a>Passos seguintes

Para saber mais sobre as mensagens do barramento de serviço, consulte os seguintes tópicos:

* [Filas, tópicos e subscrições do Service Bus](service-bus-queues-topics-subscriptions.md)
* [Introdução às filas do Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Como utilizar os tópicos e as subscrições do Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
