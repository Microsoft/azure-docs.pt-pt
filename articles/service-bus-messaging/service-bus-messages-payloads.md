---
title: As mensagens, payloads e serialização do Service Bus do Azure | Documentos da Microsoft
description: Descrição geral das transferências de mensagem do Service Bus
services: service-bus-messaging
documentationcenter: ''
author: clemensv
manager: timlt
editor: ''
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/26/2018
ms.author: spelluru
ms.openlocfilehash: 636b48f409c1a86f7da87c38b6250610026d4547
ms.sourcegitcommit: d1aef670b97061507dc1343450211a2042b01641
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 09/27/2018
ms.locfileid: "47392609"
---
# <a name="messages-payloads-and-serialization"></a>Mensagens, payloads e serialização

Barramento de serviço do Microsoft Azure trata de mensagens. Mensagens de transportar um payload de como metadados, na forma de propriedades de par chave-valor, que descreve o payload e dar instruções de processamento do Service Bus e aplicativos. Ocasionalmente, esses metadados apenas são suficiente para executar as informações que quer que o remetente para comunicar com recetores, e o payload permanece vazio.

O modelo de objeto dos clientes do Service Bus oficiais para .NET e Java refletem a abstração da estrutura de mensagens do Service Bus, o que é mapeada de e para os protocolos de transmissão do Service Bus suporta.
 
Uma mensagem do Service Bus é composta por uma secção de payload binário do Service Bus nunca processa em qualquer formulário no lado do serviço e dois conjuntos de propriedades. O *mediador propriedades* estão predefinidas pelo sistema. Essas propriedades predefinidas optar por controlam a funcionalidade de nível de mensagem dentro do Mediador, ou podem ser mapeados para itens de metadados comuns e normalizada. O *propriedades de utilizador* são uma coleção de pares chave-valor que pode ser definida e configurada pelo aplicativo.
 
As propriedades de Mediador predefinidos estão listadas na tabela seguinte. Os nomes são utilizados com todas as APIs de cliente oficial e também na [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Properties_) objeto JSON de mapeamento de protocolo HTTP.
 
Os nomes de equivalentes utilizados ao nível do protocolo AMQP são listados entre parênteses. 

| Nome da propriedade                         | Descrição                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (tipo de conteúdo)           | Opcionalmente, descreve o payload da mensagem, com um descritor seguindo o formato de RFC2045, secção 5; Por exemplo, `application/json`.                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (id de correlação)       | Permite que um aplicativo especificar um contexto para a mensagem para os fins de correlação; Por exemplo, refletindo o **MessageId** de uma mensagem que é respondida à.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deadlettersource)                      | Só é definido nas mensagens que foram lettered em papel já era e, em seguida, auto-reencaminhados a partir da fila de mensagens não entregues com outra entidade. Indica a entidade na qual a mensagem foi lettered em papel já era. Esta propriedade é só de leitura.                                                                                                                                                                                                                                  |
| [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Número de entregas que foram tentadas para esta mensagem. A contagem é incrementada quando uma mensagem de bloqueio expira ou a mensagem é abandonada explicitamente pelo destinatário. Esta propriedade é só de leitura.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Para mensagens que foram reencaminhados de automática, esta propriedade reflete o número de sequência que primeiro foi atribuído à mensagem de sua altura original de submissão. Esta propriedade é só de leitura.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | UTC instantânea em que a mensagem foi aceite e armazenada na entidade. Este valor pode ser utilizado como um indicador de tempo de chegada autoritativa e neutro quando o destinatário não deseja confiar no relógio do remetente. Esta propriedade é só de leitura.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (hora de expiração de absoluto) | O instantâneo do UTC em que a mensagem está marcada para remoção e já não está disponível para a obtenção da entidade devido à sua expiração. Expiração é controlada pelos **TimeToLive** propriedade e esta propriedade é computada da EnqueuedTimeUtc + TimeToLive. Esta propriedade é só de leitura.                                                                                                                                                                           |
| [ForcePersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | Para filas ou tópicos que têm o [EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress) sinalizar conjunto, essa propriedade pode ser definida para indicar que a mensagem de persistência no disco antes de ele é reconhecido. Este é o comportamento padrão para todas as entidades de não-express.                                                                                                                                                                                                         |
| [Etiqueta](/dotnet/api/microsoft.azure.servicebus.message.label) (assunto)                       | Esta propriedade permite à aplicação indicar a finalidade da mensagem para o destinatário de maneira padronizada, semelhante a uma linha de assunto do e-mail.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Para as mensagens obtidas num bloqueio (bloqueio de pré-visualização recebe modo, não liquidado previamente) esta propriedade reflete o UTC instantânea até a qual a mensagem é mantida bloqueada na fila/subscrição. Quando o bloqueio expira, o [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) é incrementada e a mensagem novamente está disponível para recuperação. Esta propriedade é só de leitura.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | O token de bloqueio é uma referência ao que está a ser retido por Mediador no bloqueio *bloqueio de pré-visualização* receber modo. O token pode ser usado para afixar o bloqueio permanentemente através da [diferimento](message-deferral.md) API e, com isso, pegar a mensagem fora o fluxo de estado de distribuição regular. Esta propriedade é só de leitura.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (id da mensagem)                | O identificador de mensagem é um valor definido pelo aplicativo que identifica exclusivamente a mensagem e seu payload. O identificador é uma cadeia de caracteres de forma livre e pode refletir uma GUID ou um identificador derivada do contexto do aplicativo. Se estiver ativada, o [deteção de duplicar](duplicate-detection.md) funcionalidade identifica e remove segundo e ainda mais os envios de mensagens com o mesmo **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | Para [entidades particionadas](service-bus-partitioning.md), definir este valor permite atribuir as mensagens relacionadas para a mesma partição interna, para que a ordem de sequência de submissão é registada corretamente. A partição é escolhida por uma função de hash sobre este valor e não pode ser escolhida diretamente. Para entidades com reconhecimento de sessão, o **SessionId** propriedade substitui este valor.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (responder a)                    | Este valor definido pelo aplicativo e opcional é uma forma padrão para expressar um caminho de resposta para o destinatário da mensagem. Quando um remetente espera uma resposta, ele define o valor para o caminho absoluto ou relativo da fila ou tópico que ele espera a resposta seja enviada para.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (resposta-para--id de grupo)  | Esse valor aumenta a **ReplyTo** informações e especifica qual **SessionId** deve ser definido para a resposta quando enviados para a entidade de resposta.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Para mensagens que só ficam disponíveis para recuperação após um atraso, esta propriedade define o instantânea em UTC em que a mensagem será logicamente colocados em fila, sequenciado e, portanto, disponibilizar para recuperação.                                                                                                                                                                                                                 |
| [sequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | O número de sequência é um inteiro de 64 bits exclusivo atribuído a uma mensagem como ele é aceite e armazenado pelo broker e funções como seu identificador verdadeiro. Para entidades particionadas, os mais alto 16 bits refletem o identificador de partição. Números de sequência de forma monótona aumentarem e são gapless. Eles acumulam para 0 quando o intervalo de 48-64 bits se esgota. Esta propriedade é só de leitura.                                                                |
| [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (id de grupo)                  | Para entidades com reconhecimento de sessão, este valor definido pelo aplicativo Especifica a afiliação de sessão da mensagem. Mensagens com o mesmo identificador de sessão estão sujeitos a resumo de bloqueio e ativar exata por ordem de processamento e demultiplexing. Para entidades que não estão com reconhecimento de sessão, este valor é ignorado.                                                                                                                                     |
| [Tamanho](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Reflete o tamanho armazenado da mensagem no registo de Mediador como uma contagem de bytes, como ele conta para a quota de armazenamento. Esta propriedade é só de leitura.                                                                                                                                                                                                                                                                                                       |
| [Estado](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Indica o estado da mensagem no registo. Esta propriedade só é relevante durante a mensagem de navegação ("pré-visualização"), para determinar se uma mensagem é "ativos" e estarão disponíveis para recuperação quando ela atinge a parte superior da fila, se for adiado, ou se está a aguardar para ser agendada. Esta propriedade é só de leitura.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Este valor é a duração relativa após o qual a mensagem expira, a partir de instante, a mensagem foi aceite e armazenada pelo broker, como capturado na **EnqueueTimeUtc**. Quando não estiver definido explicitamente, o valor assumido é o **DefaultTimeToLive** para a respetiva fila ou tópico. Um nível de mensagem **TimeToLive** valor não pode ser maior do que a entidade **DefaultTimeToLive** definição. Se for mais longo, ele será ajustado silenciosamente. |
| [Para](/dotnet/api/microsoft.azure.servicebus.message.to) (a)                               | Esta propriedade é reservada para utilização futura em cenários de roteamento e atualmente é ignorada pelo broker propriamente dito. Aplicações podem utilizar este valor em cenários de encadeamento do reencaminhamento orientados por regra para indicar o destino pretendido de lógico da mensagem.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Se uma mensagem é enviada através de uma fila de transferência no âmbito de uma transação, este valor seleciona a partição de fila de transferência.                                                                                                                                                                                                                                                                                                                 |

O modelo de mensagem abstrata permite que uma mensagem a publicar para uma fila por HTTP (na verdade, sempre HTTPS) e pode ser obtido através de AMQP. Em ambos os casos, a mensagem parece normal no contexto do respetivo protocolo. As propriedades de mediador são traduzidas conforme necessário, e as propriedades de utilizador são mapeadas para a localização mais adequada no modelo de mensagem do respetivo protocolo. No HTTP, as propriedades do utilizador mapeiam diretamente de e para cabeçalhos HTTP; no AMQP mapear de e para o **propriedades da aplicação** mapa.

## <a name="message-routing-and-correlation"></a>Roteamento de mensagens e da correlação

Um subconjunto das propriedades de Mediador descrito anteriormente, especificamente [para](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [ CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid), e [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), são utilizados para ajudar aplicativos rotear mensagens para destinos específicos. Para ilustrar isso, considere alguns padrões:

- **Simple de solicitação/resposta**: um publicador envia uma mensagem numa fila e esperar uma resposta de consumidor de mensagens. Para receber a resposta, o publicador é proprietário de uma fila na qual ele espera respostas a entregar. O endereço dessa fila é expressa no **ReplyTo** propriedade da mensagem de saída. Quando o consumidor responde, copia o **MessageId** da mensagem processada para o **CorrelationId** propriedade da mensagem de resposta e oferece a mensagem para o destino indicada pelo **ReplyTo** propriedade. Uma mensagem pode resultar em várias respostas, consoante o contexto do aplicativo.
- **Multicast de solicitação/resposta**: como uma variação do padrão anterior, um publicador envia a mensagem num tópico e vários subscritores torna-se elegível para consumir a mensagem. Cada um dos subscritores pode responder do modo descrito anteriormente. Esse padrão é usado em cenários de deteção ou a chamada de implementação e o pesquisado normalmente identifica-se com uma propriedade de utilizador ou dentro do payload. Se **ReplyTo** aponta para um tópico, o conjunto de respostas de deteção pode ser distribuídas para um público-alvo.
- **Multiplexação**: esta funcionalidade de sessão permite a multiplexação dos fluxos de mensagens relacionadas através de uma única fila ou subscrição, de modo a que cada sessão (ou grupo) de mensagens relacionadas, identificado por correspondentes **SessionId**valores, são encaminhados para um recetor específico, enquanto o recetor realiza a sessão em bloqueio. Saiba mais sobre os detalhes de sessões [aqui](message-sessions.md).
- **Multiplexadas solicitação/resposta**: esta funcionalidade de sessão permite respostas multiplexadas, permitindo que vários editores de partilhar uma fila de resposta. Definindo **ReplyToSessionId**, o publicador pode instruir o consumer(s) para copiar esse valor para o **SessionId** propriedade da mensagem de resposta. A fila ou tópico de publicação não precisa de ser com reconhecimento de sessão. Como a mensagem é enviada, o publicador, em seguida, pode aguardar especificamente para uma sessão com o determinado **SessionId** para materializar na fila ao aceitar condicionalmente um recetor de sessão. 

Encaminhamento dentro de um espaço de nomes do Service Bus pode ser obtida usando o encadeamento de reencaminhamento e as regras de subscrição de tópico. Encaminhamento através de espaços de nomes pode ser percebido [com o Azure LogicApps](https://azure.microsoft.com/services/logic-apps/). Conforme indicado na lista anterior, o **para** propriedade está reservada para utilização futura e, eventualmente, podem ser interpretada pelo broker com um recurso especialmente ativado. Aplicações que pretendem implementar o encaminhamento devem fazer então com base nas propriedades de utilizador e não contar com o **para** propriedade; no entanto, se o fizer, agora não causará problemas de compatibilidade.

## <a name="payload-serialization"></a>Serialização de payload

Quando em trânsito ou armazenados dentro do Service Bus, o payload é sempre um bloco opaco, binário. O [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) propriedade permite que os aplicativos descrever o payload, com o formato sugerido para os valores de propriedade que está a ser uma descrição do tipo de conteúdo MIME, de acordo com IETF RFC2045; por exemplo, `application/json;charset=utf-8`.

Ao contrário das variantes Java ou .NET padrão, o .NET Framework versão de API do Service Bus suporta a criação **BrokeredMessage** instâncias ao transmitir objetos arbitrários do .NET para o construtor. 

Ao utilizar o protocolo SBMP herdado, esses objetos, em seguida, são serializados com o serializador binário de predefinição ou com um serializador externamente fornecido. Ao utilizar o protocolo AMQP, o objeto é serializado num objeto AMQP. O destinatário pode recuperar esses objetos com o [GetBody<T>()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1) All, fornecendo o tipo esperado. Com o AMQP, os objetos são serializados num gráfico AMQP da **ArrayList** e **IDictionary < string, object >** objetos e qualquer cliente AMQP podem decodificá-las. 

Enquanto essa mágica de serialização oculto é conveniente, os aplicativos devem assumir o controlo explícito de serialização do objeto e transformar seus gráficos de objetos em fluxos antes de incluí-los numa mensagem e fazer o inverso no lado do receptor. Isso produz resultados interoperáveis. Também deve observar que, enquanto o AMQP tem um poderoso modelo de codificação binário, esta é associada ao ecossistema de mensagens de AMQP e clientes HTTP terá problemas para descodificação essas cargas. 

Em geral, recomendamos que JSON e Apache Avro como formatos de payload para dados estruturados.

As variantes de API de Java e .NET Standard aceitam apenas matrizes de bytes, que significa que a aplicação deve processar o controle de serialização do objeto. 

## <a name="next-steps"></a>Passos Seguintes

Para saber mais sobre mensagens do Service Bus, consulte os seguintes tópicos:

* [Noções básicas sobre o Service Bus](service-bus-fundamentals-hybrid-solutions.md)
* [Filas, tópicos e subscrições do Service Bus](service-bus-queues-topics-subscriptions.md)
* [Introdução às filas do Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Como utilizar os tópicos e as subscrições do Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)
