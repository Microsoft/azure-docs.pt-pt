---
title: Extensão antimalware da Microsoft para VMs do Windows em Azure
description: Implemente a extensão Azure Antimalware na máquina virtual do Windows utilizando uma extensão.
services: virtual-machines-windows
documentationcenter: ''
author: TerryLanfear
manager: rkarlin
editor: ''
ms.assetid: ''
ms.service: virtual-machines-windows
ms.subservice: extensions
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 02/23/2021
ms.author: terrylan
ms.openlocfilehash: f28c886b8dc082c8aca80069897492a70291597a
ms.sourcegitcommit: b4647f06c0953435af3cb24baaf6d15a5a761a9c
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 03/02/2021
ms.locfileid: "101667290"
---
# <a name="microsoft-antimalware-extension-for-windows"></a>Extensão antimalware da Microsoft para Windows

## <a name="overview"></a>Descrição Geral

O panorama de ameaças moderna para ambientes em nuvem é extremamente dinâmico, aumentando a pressão sobre os subscritores de nuvem de TI de negócios para manter uma proteção eficaz de modo a satisfazer os requisitos de conformidade e segurança. O Microsoft Antimalware for Azure é uma capacidade de proteção gratuita em tempo real que ajuda a identificar e remover vírus, spyware e outros softwares maliciosos, com alertas configuráveis quando o software malicioso ou indesejado tenta instalar-se ou funcionar nos seus sistemas Azure. A solução é construída na mesma plataforma antimalware que o Microsoft Security Essentials (MSE), Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Windows Intune e Windows Defender para Windows 8.0 e superior.
O Microsoft Antimalware for Azure é uma solução de agente único para aplicações e ambientes de inquilinos, projetado para funcionar em segundo plano sem intervenção humana. Pode implementar proteção com base nas necessidades das cargas de trabalho da sua aplicação, com configuração personalizada básica de segurança por defeito ou avançada, incluindo monitorização antimalware.

## <a name="prerequisites"></a>Pré-requisitos

### <a name="operating-system"></a>Sistema operativo

A solução Microsoft Antimalware for Azure inclui o Cliente e Serviço da Microsoft Antimalware, modelo de implementação clássico antimalware, cmdlets Antimalware PowerShell e Extensão de Diagnóstico Azure. A solução de Antimalware da Microsoft é suportada nas famílias do sistema operativo Windows Server 2008 R2, Windows Server 2012 e Windows Server 2012 R2. Não é suportado no sistema operativo Windows Server 2008, e também não é suportado no Linux. 

O Windows Defender é o Antimalware incorporado ativado no Windows Server 2016. A Interface do Windows Defender também é ativada por padrão em alguns SKU do Windows Server 2016.
A extensão de Antimalware Azure VM ainda pode ser adicionada a um Windows Server 2016 Azure VM com Windows Defender, mas neste cenário a extensão aplicará quaisquer políticas de configuração opcionais a serem utilizadas pelo Windows Defender, a extensão não irá implementar nenhum serviço antimalware adicional. Pode ler mais sobre esta atualização [aqui.](/archive/blogs/azuresecurity/update-to-azure-antimalware-extension-for-cloud-services)

### <a name="internet-connectivity"></a>Conectividade Internet

O Antimalware da Microsoft para windows requer que a máquina virtual-alvo esteja ligada à internet para receber atualizações regulares do motor e da assinatura. 

## <a name="template-deployment"></a>Implementação de modelos
As extensões Azure VM podem ser implementadas com modelos Azure Resource Manager. Os modelos são ideais quando se implanta uma ou mais máquinas virtuais que requerem configuração de implementação de posts, como a bordo do Azure Antimalware.

A configuração JSON para uma extensão de máquina virtual pode ser aninhada dentro do recurso de máquina virtual, ou colocada no nível raiz ou superior de um modelo JSON do Gestor de Recursos. A colocação da configuração JSON afeta o valor do nome e do tipo do recurso. Para obter mais informações, consulte [o nome definido e o tipo para obter recursos para crianças.](../../azure-resource-manager/templates/child-resource-name-type.md) 

O exemplo a seguir pressupõe que a extensão VM está aninhada dentro do recurso da máquina virtual. Ao nidificar o recurso de extensão, o JSON é colocado no `"resources": []` objeto da máquina virtual.

```json
{
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('vmName'),'/', parameters('vmExtensionName'))]",
      "apiVersion": "2019-07-01",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]"
      ],

      "properties": {
        "publisher": "Microsoft.Azure.Security",
        "type": "IaaSAntimalware",
        "typeHandlerVersion": "1.3",
        "autoUpgradeMinorVersion": true,
        "settings": {
          "AntimalwareEnabled": "true",
          "Exclusions": {
            "Extensions": ".log;.ldf",
            "Paths": "D:\\IISlogs;D:\\DatabaseLogs",
            "Processes": "mssence.svc"
          },

          "RealtimeProtectionEnabled": "true",
          "ScheduledScanSettings": {
            "isEnabled": "true",
            "scanType": "Quick",
            "day": "7",
            "time": "120"
          }
        },
        "protectedSettings": null
      }
}
```

## <a name="powershell-deployment"></a>Implementação do PowerShell
Depende do seu tipo de implantação, utilize os comandos correspondentes para implantar a extensão da máquina virtual Azure Antimalware a uma máquina virtual existente.

  * [Máquina virtual baseada em recursos Azure](../../security/fundamentals/antimalware-code-samples.md#enable-and-configure-microsoft-antimalware-for-azure-resource-manager-vms)
  * [Aglomerados de tecido de serviço Azure](../../security/fundamentals/antimalware-code-samples.md#add-microsoft-antimalware-to-azure-service-fabric-clusters)
  * [Serviço de nuvem clássica](https://docs.microsoft.com/powershell/module/servicemanagement/azure.service/set-azureserviceextension)

## <a name="troubleshoot-and-support"></a>Resolução de problemas e apoio

### <a name="troubleshoot"></a>Resolução de problemas

Os registos de extensão antimalware da Microsoft estão disponíveis em - %Systemdrive%\WindowsAzure\Logs\Plugins\Microsoft.Azure.Security.IaaSAntimalware(Ou PaaSAntimalware)\1.5.5.x (versão#)\CommandExecution.log

### <a name="error-codes-and-their-meanings"></a>Códigos de erro e os seus significados

| Código de erro | Significado | Possível ação |
| :---: | --- | --- |
| -2147156224 | MSI está ocupado com diferentes instalações | Tente executar a instalação última |
| -2147156221 | Configuração MSE já em execução | Executar apenas um caso de cada vez |
| -2147156208 | Espaço de disco baixo < 200 MB | Eliminar ficheiros não reutilizados e tentar novamente a instalação |
| -2147156187 | Última instalação, atualização, atualização ou desinstalar o reboot solicitado | Reiniciar e tentar a instalação |
| -2147156121 | A configuração tentou remover o produto concorrente. Mas o produto concorrente desinstalar falhou | Tente remover o produto concorrente manualmente, reinicie e reforce a instalação  |
| -2147156116 | A validação do ficheiro de política falhou | Certifique-se de que passa um ficheiro XML de política válido para configurar  |
| -2147156095 | A configuração não poderia iniciar o serviço antimalware | Verifique se todos os binários estão corretamente assinados, e o ficheiro de licenciamento certo é instalado |
| -2147023293 | Ocorreu um erro fatal durante a instalação. Na maioria dos casos, vai. Epp.msi, não pode registar\start\stop serviço AM ou mini filter | Registos de MSI de EPP.msi são necessários aqui para futura investigação |
| -2147023277 | Pacote de instalação não pôde ser aberto | Verifique se a embalagem existe e está acessível, ou contacte o fornecedor de aplicações para verificar se este é um pacote instalador do Windows válido |
| -2147156109 | Defender é necessário como pré-requisito |  |
| -2147205073 | O emitente websso não é suportado | |
| -2147024893 | O sistema não pode encontrar o caminho especificado |  |
| -2146885619 | Não uma mensagem criptográfica ou a mensagem criptográfica não é formatada corretamente |  |
| -1073741819 | A instrução a 0x%p referenciada memória a 0x%p. A memória não podia ser %s |  |
| 1 | Função incorreta |  |


### <a name="support"></a>Suporte

Se precisar de mais ajuda em qualquer ponto deste artigo, pode contactar os especialistas da Azure nos [fóruns msdn Azure e Stack Overflow](https://azure.microsoft.com/support/forums/). Em alternativa, pode apresentar um incidente de suporte Azure. Vá ao [site de suporte do Azure](https://azure.microsoft.com/support/options/)e selecione Obter suporte. Para obter informações sobre a utilização do Suporte Azure, leia o [suporte do Microsoft Azure FAQ](https://azure.microsoft.com/support/faq/).