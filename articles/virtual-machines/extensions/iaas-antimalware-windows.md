---
title: Extensão Microsoft antimalware para VMs do Windows no Azure
description: Implante a extensão de antimalware do Azure na máquina virtual do Windows usando uma extensão.
services: virtual-machines-windows
documentationcenter: ''
author: TomShinder
manager: gwallace
editor: ''
ms.assetid: ''
ms.service: virtual-machines-windows
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 04/12/2018
ms.author: tomsh
ms.openlocfilehash: 2634a11c585329b069ac5f3702b8296d1dd23a79
ms.sourcegitcommit: a170b69b592e6e7e5cc816dabc0246f97897cb0c
ms.translationtype: MT
ms.contentlocale: pt-PT
ms.lasthandoff: 11/14/2019
ms.locfileid: "74092202"
---
# <a name="microsoft-antimalware-extension-for-windows"></a>Extensão Microsoft antimalware para Windows

## <a name="overview"></a>Descrição geral

O panorama de ameaças moderna para ambientes de nuvem é extremamente dinâmico, aumentando a pressão nos assinantes da nuvem de ti de ti para manter a proteção efetiva a fim de atender aos requisitos de conformidade e segurança. O Microsoft antimalware para Azure é um recurso de proteção em tempo real gratuito que ajuda a identificar e remover vírus, spyware e outros softwares mal-intencionados, com alertas configuráveis quando um software mal-intencionado ou indesejado conhecido tenta se instalar ou ser executado em seu Sistemas do Azure. A solução foi criada na mesma plataforma antimalware que o Microsoft Security Essentials (MSE), Microsoft Forefront Endpoint Protection, Microsoft System Center Endpoint Protection, Windows Intune e Windows Defender para Windows 8,0 e superior.
O Microsoft antimalware para Azure é uma solução de agente único para aplicativos e ambientes de locatário, projetada para ser executada em segundo plano sem intervenção humana. Você pode implantar a proteção com base nas necessidades de suas cargas de trabalho de aplicativo, com a configuração básica de segurança padrão ou personalizada avançada, incluindo o monitoramento antimalware.

## <a name="prerequisites"></a>Pré-requisitos

### <a name="operating-system"></a>Sistema operativo

A solução Microsoft antimalware para Azure inclui o cliente Microsoft Antimalware, o modelo de implantação clássico de Antimalware, os cmdlets do PowerShell antimalware e a extensão Diagnóstico do Azure. A solução antimalware da Microsoft tem suporte nas famílias do sistema operacional Windows Server 2008 R2, Windows Server 2012 e Windows Server 2012 R2. Não há suporte para ele no sistema operacional Windows Server 2008 e também não tem suporte no Linux. 

O Windows Defender é o antimalware interno habilitado no Windows Server 2016. A interface do Windows Defender também é habilitada por padrão em alguns SKUs do Windows Server 2016.
A extensão antimalware de VM do Azure ainda pode ser adicionada a uma VM do Azure do Windows Server 2016 com o Windows Defender, mas nesse cenário a extensão aplicará quaisquer políticas de configuração opcionais a serem usadas pelo Windows Defender, a extensão não implantará nenhuma serviço de antimalware adicional. Você pode ler mais sobre essa atualização [aqui](https://blogs.msdn.microsoft.com/azuresecurity/2017/03/07/update-to-azure-antimalware-extension-for-cloud-services/).

### <a name="internet-connectivity"></a>Conectividade Internet

O Microsoft antimalware para Windows requer que a máquina virtual de destino esteja conectada à Internet para receber atualizações regulares de mecanismo e assinatura. 

## <a name="template-deployment"></a>Implementação de modelos
Extensões VM do Azure podem ser implementadas com modelos Azure Resource Manager. Os modelos são ideais ao implantar uma ou mais máquinas virtuais que exigem a configuração pós-implantação, como a integração com o antimalware do Azure.

A configuração do JSON para uma extensão de máquina virtual pode ser aninhada dentro do recurso de máquina virtual ou colocada na raiz ou de nível superior de um modelo do Resource Manager JSON. A colocação da configuração do JSON afeta o valor do tipo e nome do recurso. Para obter mais informações, consulte [defina o nome e tipo para recursos subordinados](../../azure-resource-manager/child-resource-name-type.md). 

O exemplo a seguir supõe que a extensão de VM é aninhada dentro do recurso de máquina virtual. Quando aninhar o recurso de extensão, o JSON é colocado no `"resources": []` objeto da máquina virtual.

```json
{
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('vmName'),'/', parameters('vmExtensionName'))]",
      "apiVersion": "2017-03-30",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]"
      ],

      "properties": {
        "publisher": "Microsoft.Azure.Security",
        "type": "IaaSAntimalware",
        "typeHandlerVersion": "1.3",
        "autoUpgradeMinorVersion": true,
        "settings": {
          "AntimalwareEnabled": "true",
          "Exclusions": {
            "Extensions": ".log;.ldf",
            "Paths": "D:\\IISlogs;D:\\DatabaseLogs",
            "Processes": "mssence.svc"
          },

          "RealtimeProtectionEnabled": "true",
          "ScheduledScanSettings": {
            "isEnabled": "true",
            "scanType": "Quick",
            "day": "7",
            "time": "120"
          }
        },
        "protectedSettings": null
      }
}
```

## <a name="powershell-deployment"></a>Implantação do PowerShell
Depende do tipo de implantação, use os comandos correspondentes para implantar a extensão de máquina virtual antimalware do Azure em uma máquina virtual existente.

  * Máquina virtual de IaaS clássica- https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension
  * Máquina virtual com base em Azure Resource Manager- https://blogs.msdn.microsoft.com/azuresecurity/2016/02/24/update-on-microsoft-antimalware-and-azure-resource-manager-arm-vms/
  * Clusters de Service Fabric do Azure- https://blogs.msdn.microsoft.com/azuresecurity/2016/10/07/add-microsoft-antimalware-to-azure-service-fabric-clusters/
  * Serviço de nuvem clássico- https://docs.microsoft.com/powershell/module/servicemanagement/azure/set-azureserviceantimalwareextension

## <a name="troubleshoot-and-support"></a>Resolução de problemas e suporte

### <a name="troubleshoot"></a>Resolução de problemas

Os logs de extensão antimalware da Microsoft estão disponíveis em-%Systemdrive%\WindowsAzure\Logs\Plugins\Microsoft.Azure.Security.IaaSAntimalware (ou PaaSAntimalware) \1.5.5.x (Version #) \CommandExecution.log

### <a name="error-codes-and-their-meanings"></a>Códigos de erro e seus significados

| Código de erro | Significado | Ação possível |
| :---: | --- | --- |
| -2147156224 | O MSI está ocupado com uma instalação diferente | Tente executar a instalação por último |
| -2147156221 | A instalação do MSE já está em execução | Executar apenas uma instância por vez |
| -2147156208 | Espaço em disco insuficiente < 200 MB | Exclua arquivos não utilizados e tente a instalação novamente |
| -2147156187 | Última instalação, atualização, atualização ou desinstalação solicitada reinicialização | Reinicialize e repita a instalação |
| -2147156121 | A instalação tentou remover o produto do concorrente. Mas a desinstalação do produto concorrente falhou | Tente remover o produto concorrente manualmente, reinicializar e repetir a instalação  |
| -2147156116 | Falha na validação do arquivo de política | Certifique-se de passar um arquivo XML de política válido para a instalação  |
| -2147156095 | A instalação não pôde iniciar o serviço Antimalware | Verifique se todos os binários estão assinados corretamente e se o arquivo de licenciamento correto está instalado |
| -2147023293 | Ocorreu um erro fatal durante A instalação. Na maioria dos casos, será. EPP. msi, não é possível register\start\stop o serviço AM ou o driver de mini filtro | Os logs do MSI de EPP. msi são necessários aqui para investigação futura |
| -2147023277 | Não foi possível abrir o pacote de instalação | Verifique se o pacote existe e está acessível ou contate o fornecedor do aplicativo para verificar se este é um pacote de Windows Installer válido |
| -2147156109 | O defender é necessário como um pré-requisito |  |
| -2147205073 | Não há suporte para o emissor de websns | |
| -2147024893 | O sistema não pode localizar o caminho especificado |  |
| -2146885619 | Não é uma mensagem criptográfica ou a mensagem criptográfica não está formatada corretamente |  |
| -1073741819 | A instrução em 0x% p referenciou a memória em 0x% p. A memória não pôde ser% s |  |
| 1 | Função incorreta |  |


### <a name="support"></a>Suporte

Se precisar de mais ajuda a qualquer momento neste artigo, pode contactar os especialistas do Azure sobre o [fóruns do Azure do MSDN e Stack Overflow](https://azure.microsoft.com/support/forums/). Em alternativa, pode enviar um incidente de suporte do Azure. Vá para o [site de suporte do Azure](https://azure.microsoft.com/support/options/)e selecione obter suporte. Para informações sobre como utilizar o suporte do Azure, leia os [FAQ do suporte Microsoft Azure](https://azure.microsoft.com/support/faq/).
